<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="åšæŒè¾“å‡ºï¼ŒåšæŒä¹¦å†™ï¼Œæ‰å¯ä»¥æŒç»­æˆé•¿">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      ConcurrentHashMapæ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„ | JasonGao Thoughts
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    <script src="/js/qrious.js"></script>
  
  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


  
  
    <script src="/js/local-search.js"></script>

<link rel="alternate" href="atom.xml" title="JasonGao Thoughts" type="application/atom+xml">
</head>
<div class="wechat-share">
  <img src="/css/images/logo.png">
</div>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>JasonGao Thoughts</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
      
        <li class="menu-item menu-item-search right-list">
    <a role="button" class="popup-trigger">
        <i class="fa fa-search fa-fw"></i>
    </a>
</li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
    
      <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
            <span class="search-icon">
                <i class="fa fa-search"></i>
            </span>
            <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="Please enter your keyword(s) to search." spellcheck="false" type="search" class="search-input">
            </div>
            <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>
    
  </div>
</header>

    <div id="article-banner">
  <h2>ConcurrentHashMapæ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„</h2>
  <p class="post-date">2020-05-21</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><blockquote>
<p>æ–‡ç« å·²åŒæ­¥å‘è¡¨äºå¾®ä¿¡å…¬ä¼—å·JasonGaoHï¼Œ<a href="https://mp.weixin.qq.com/s?__biz=MzUyNTE2OTAzMQ==&amp;mid=2247483797&amp;idx=1&amp;sn=cb28703e574bbf5df4563d3aef65be01&amp;chksm=fa23797dcd54f06b34b405d4eef74a14df420fcc16b6b1e42fb16060972ea20c8695ee8c5f29&amp;token=1938879438&amp;lang=zh_CN#rd" target="_blank" rel="noopener">ConcurrentHashMapæ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„</a></p>
</blockquote>
<p>ä¹‹å‰åˆ†æè¿‡HashMapçš„ä¸€äº›å®ç°ç»†èŠ‚ï¼Œ<a href="https://blog.csdn.net/H_Gao/article/details/90746413" target="_blank" rel="noopener">å…³äºHashMapä½ éœ€è¦çŸ¥é“çš„ä¸€äº›ç»†èŠ‚</a>, ä»Šå¤©æˆ‘ä»¬ä»æºç è§’åº¦æ¥çœ‹çœ‹ConcurrentHashMapæ˜¯å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨çš„ï¼Œå…¶å®ç½‘ä¸Šè¿™ç±»æ–‡ç« åˆ†æç‰¹åˆ«å¤šï¼Œç§‰ç€â€çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç»çŸ¥æ­¤äº‹è¦èº¬è¡Œâ€œçš„åŸåˆ™ï¼Œæˆ‘ä»¬å°è¯•è‡ªå·±å»åˆ†æä¸‹ï¼Œå¸Œæœ›è¿™æ ·å¯¹äºConcurrentHashMapæœ‰ä¸€ä¸ªæ›´æ·±åˆ»çš„ç†è§£ã€‚</p>
 <a id="more"></a>
<h3 id="ä¸ºä»€ä¹ˆè¯´HashMapçº¿ç¨‹ä¸å®‰å…¨ï¼Œè€ŒConcurrentHashMapå°±çº¿ç¨‹å®‰å…¨"><a href="#ä¸ºä»€ä¹ˆè¯´HashMapçº¿ç¨‹ä¸å®‰å…¨ï¼Œè€ŒConcurrentHashMapå°±çº¿ç¨‹å®‰å…¨" class="headerlink" title="ä¸ºä»€ä¹ˆè¯´HashMapçº¿ç¨‹ä¸å®‰å…¨ï¼Œè€ŒConcurrentHashMapå°±çº¿ç¨‹å®‰å…¨"></a>ä¸ºä»€ä¹ˆè¯´HashMapçº¿ç¨‹ä¸å®‰å…¨ï¼Œè€ŒConcurrentHashMapå°±çº¿ç¨‹å®‰å…¨</h3><p>å…¶å®ConcurrentHashMapåœ¨Androidå¼€å‘ä¸­ä½¿ç”¨çš„åœºæ™¯å¹¶ä¸å¤šï¼Œä½†æ˜¯ConcurrentHashMapä¸ºäº†æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘è¿™äº›ä¼˜ç§€çš„è®¾è®¡å´æ˜¯æœ€å€¼å¾—æˆ‘ä»¬å­¦ä¹ çš„åœ°æ–¹ï¼Œå¾€å¾€â€ConcurrentHashMapæ˜¯å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨â€œè¿™ç±»é—®é¢˜å´æ˜¯é¢è¯•å®˜æ¯”è¾ƒå–œæ¬¢é—®çš„é—®é¢˜ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å°è¯•ç”¨ä»£ç æ¨¡æ‹Ÿä¸‹HashMapåœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸‹ä¼šä¸å®‰å…¨ï¼Œå¦‚æœæŠŠè¿™ä¸ªåœºæ™¯æ›¿æ¢æˆConcurrentHashMapä¼šä¸ä¼šæœ‰é—®é¢˜ã€‚</p>
<p>å› ä¸ºä¸åŒäºå…¶ä»–çš„çº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œæƒ³æ¨¡æ‹Ÿå‡ºä¸€ç§åœºæ™¯æ¥è¡¨æ˜HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ç¨å¾®æœ‰ç‚¹éº»çƒ¦ï¼Œå¯èƒ½æ˜¯hashæ•£åˆ—æœ‰å…³ï¼Œåœ¨æ•°æ®é‡è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œè®¡ç®—å‡ºæ¥çš„hashCodeæ˜¯ä¸å¤ªå®¹æ˜“äº§ç”Ÿç¢°æ’çš„ï¼Œç½‘ä¸Šå¾ˆå¤šæ–‡ç« éƒ½æ˜¯å°è¯•ä»æºç è§’åº¦æ¥åˆ†æHashMapå¯èƒ½ä¼šå¯¼è‡´çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸‹ä¸‹é¢è¿™æ®µä»£ç ,æˆ‘ä»¬æ„é€ 10ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ†åˆ«å¾€mapä¸­put 1000ä¸ªæ•°æ®ï¼Œä¸ºäº†ä¿è¯æ¯ä¸ªæ•°æ®çš„keyä¸ä¸€æ ·ï¼Œæˆ‘ä»¬å°†i+ çº¿ç¨‹åå­—æ¥ä½œä¸ºmap çš„keyï¼Œè¿™æ ·ï¼Œå¦‚æœæ‰€æœ‰çš„çº¿ç¨‹éƒ½ç´¯åŠ å®Œçš„è¯ï¼Œæˆ‘ä»¬é¢„æœŸçš„mapçš„sizeåº”è¯¥æ˜¯10 * 1000 = 10000ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashMapTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">		</span><br><span class="line"><span class="comment">//   	 Map&lt;String, String&gt; map = new ConcurrentHashMap&lt;String, String&gt;();</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">			MyThread testThread = <span class="keyword">new</span> MyThread(map, <span class="string">"çº¿ç¨‹åå­—ï¼š"</span> + i);</span><br><span class="line">	    	testThread.start();</span><br><span class="line">	    &#125;</span><br><span class="line">		<span class="comment">//ç­‰å¾…æ‰€æœ‰çº¿ç¨‹éƒ½ç»“æŸ</span></span><br><span class="line">		<span class="keyword">while</span>(Thread.activeCount() &gt; <span class="number">1</span>)</span><br><span class="line">			Thread.yield();</span><br><span class="line">		</span><br><span class="line">		System.out.println(map.size());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; map;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyThread</span><span class="params">(Map&lt;String, String&gt; map, String name)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.map = map;</span><br><span class="line">      <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>;i&lt;<span class="number">1000</span>;i++) &#123;</span><br><span class="line">    		map.put(i + name, i + name);</span><br><span class="line">    	&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨HashMapï¼Œç¨‹åºè¿è¡Œï¼Œç»“æœå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">9930</span><br></pre></td></tr></table></figure></p>
<p>é‚£æˆ‘ä»¬å¦‚æœæŠŠè¿™é‡Œçš„HashMapæ¢æˆConcurrentHashMapæ¥è¯•è¯•çœ‹çœ‹æ•ˆæœå¦‚ä½•ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10000</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å‘ç°ä¸ç®¡è¿è¡Œå‡ æ¬¡ï¼ŒHashMapçš„sizeéƒ½æ˜¯å°äº10000çš„ï¼Œè€ŒConcurrentHashMapçš„sizeéƒ½æ˜¯10000ã€‚ä»è¿™ä¸ªè§’åº¦ä¹Ÿè¯æ˜äº†ConcurrentHashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€ŒHashMapåˆ™æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚<br>HashMapåœ¨å¤šçº¿ç¨‹putçš„æ—¶å€™ï¼Œå½“äº§ç”Ÿhashç¢°æ’çš„æ—¶å€™ï¼Œä¼šå¯¼è‡´ä¸¢å¤±æ•°æ®ï¼Œå› ä¸ºè¦putçš„ä¸¤ä¸ªå€¼hashç›¸åŒï¼Œå¦‚æœè¿™ä¸ªå¯¹äºhashæ¡¶çš„ä½ç½®ä¸ªæ•°å°äº8ï¼Œé‚£ä¹ˆåº”è¯¥æ˜¯ä»¥é“¾è¡¨çš„å½¢å¼å­˜å‚¨ï¼Œç”±äºæ²¡æœ‰åšé€šè¿‡ï¼Œåé¢putçš„å…ƒç´ å¯èƒ½ä¼šç›´æ¥è¦†ç›–ä¹‹å‰é‚£ä¸ªçº¿ç¨‹putçš„æ•°æ®ï¼Œè¿™æ ·å°±å¯¼è‡´äº†æ•°æ®ä¸¢å¤±ã€‚</p>
<p>å…¶å®åˆ—ä¸¾ä¸Šé¢è¿™ä¸ªä¾‹å­åªæ˜¯ä¸ºäº†ä»ä¸€ä¸ªè§’åº¦æ¥å±•ç¤ºä¸‹ä¸ºä»€ä¹ˆè¯´HashMapçº¿ç¨‹ä¸å®‰å…¨ï¼Œè€ŒConcurrentHashMapåˆ™æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé‰´äºHashMapçº¿ç¨‹å®‰å…¨ä¾‹å­æ¯”è¾ƒéš¾åˆ—ä¸¾å‡ºæ¥ï¼Œæ‰€æœ‰æ‰é€šè¿‡æ‰“å°sizeè¿™ä¸ªè§’åº¦æ¥æ¨¡æ‹Ÿäº†ä¸‹ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« <a href="https://juejin.im/post/5c8910286fb9a049ad77e9a3" target="_blank" rel="noopener">æ·±å…¥è§£è¯»HashMapçº¿ç¨‹å®‰å…¨æ€§é—®é¢˜</a>å°±è¯¦ç»†ä»‹ç»äº†HashMapå¯èƒ½ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚<br>æ–‡ç« ä¸»è¦è®²äº†ä¸¤ä¸ªå¯èƒ½ä¼šå‡ºç°çº¿ç¨‹ä¸å®‰å…¨åœ°æ–¹ï¼Œä¸€ä¸ªæ˜¯å¤šçº¿ç¨‹çš„putå¯èƒ½å¯¼è‡´å…ƒç´ çš„ä¸¢å¤±ï¼Œå¦ä¸€ä¸ªæ˜¯putå’Œgetå¹¶å‘æ—¶ï¼Œå¯èƒ½å¯¼è‡´getä¸ºnullï¼Œä½†æ˜¯ä¹Ÿä»…æ˜¯åœ¨æºç å±‚é¢åˆ†æäº†ä¸‹ï¼Œå› ä¸ºè¿™ä¸­åœºæ™¯æƒ³è¦å®Œå…¨ç”¨ä»£ç å±•ç¤ºå‡ºæ¥æ˜¯ç¨å¾®æœ‰ç‚¹éº»çƒ¦çš„ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹ConcurrentHashMapæ˜¯å¦‚ä½•åšåˆ°çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<h3 id="JDK8çš„ConcurrentHashMapæ–‡æ¡£æç‚¼"><a href="#JDK8çš„ConcurrentHashMapæ–‡æ¡£æç‚¼" class="headerlink" title="JDK8çš„ConcurrentHashMapæ–‡æ¡£æç‚¼"></a>JDK8çš„ConcurrentHashMapæ–‡æ¡£æç‚¼</h3><ul>
<li>ConcurrentHashMapæ”¯æŒæ£€ç´¢çš„å®Œå…¨å¹¶å‘å’Œæ›´æ–°çš„é«˜é¢„æœŸå¹¶å‘æ€§,è¿™é‡Œçš„è¯´æ³•å¾ˆæœ‰æ„æ€æ£€ç´¢æ”¯æŒå®Œå…¨å¹¶å‘ï¼Œæ›´æ–°åˆ™æ”¯æŒé«˜é¢„æœŸå¹¶å‘æ€§ï¼Œå› ä¸ºå®ƒçš„æ£€ç´¢æ“ä½œæ˜¯æ²¡æœ‰åŠ é”çš„ï¼Œå®é™…ä¸Šæ£€ç´¢ä¹Ÿæ²¡æœ‰å¿…è¦åŠ é”ã€‚</li>
<li>å®é™…ä¸ŠConcurrentHashMapå’ŒHashtableåœ¨ä¸è€ƒè™‘å®ç°ç»†èŠ‚æ¥è¯´ï¼Œè¿™ä¸¤è€…å®Œå…¨æ˜¯å¯ä»¥äº’ç›¸æ“ä½œçš„,Hashtableåœ¨getï¼Œputï¼Œremoveç­‰è¿™äº›æ–¹æ³•ä¸­å…¨éƒ¨åŠ å…¥äº†synchronizedï¼Œè¿™æ ·çš„é—®é¢˜æ˜¯èƒ½å¤Ÿå®ç°çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯æ€§èƒ½å¤ªå·®ï¼Œå‡ ä¹æ‰€æœ‰çš„æ“ä½œéƒ½åŠ é”çš„ï¼Œä½†æ˜¯ConcurrentHashMapçš„æ£€æµ‹æ“ä½œå´æ˜¯æ²¡æœ‰åŠ é”çš„ã€‚</li>
<li>ConcurrentHashMapæ£€ç´¢æ“ä½œ(åŒ…æ‹¬get)é€šå¸¸ä¸ä¼šé˜»å¡ï¼Œå› æ­¤å¯èƒ½ä¸æ›´æ–°æ“ä½œ(åŒ…æ‹¬putå’Œremove)é‡å ã€‚</li>
<li><p>ConcurrentHashMapè·ŸHashtableç±»ä¼¼ä½†ä¸åŒäºHashMapï¼Œå®ƒä¸å¯ä»¥å­˜æ”¾ç©ºå€¼ï¼Œkeyå’Œvalueéƒ½ä¸å¯ä»¥ä¸ºnullã€‚</p>
<p>å°è±¡ä¸­ä¸€ç›´ä»¥ä¸ºConcurrentHashMapæ˜¯åŸºäºSegmentåˆ†æ®µé”æ¥å®ç°çš„ï¼Œä¹‹å‰æ²¡ä»”ç»†çœ‹è¿‡æºç ï¼Œä¸€ç›´æœ‰è¿™ä¹ˆä¸ªé”™è¯¯çš„è®¤è¯†ã€‚ConcurrentHashMapæ˜¯åŸºäºSegmentåˆ†æ®µé”æ¥å®ç°çš„ï¼Œè¿™å¥è¯ä¹Ÿä¸èƒ½è¯´ä¸å¯¹ï¼ŒåŠ ä¸ªå‰ææ¡ä»¶å°±æ˜¯æ­£ç¡®çš„äº†ï¼ŒConcurrentHashMapä»JDK1.5å¼€å§‹éšjava.util.concurrentåŒ…ä¸€èµ·å¼•å…¥JDKä¸­ï¼Œåœ¨JDK8ä»¥å‰ï¼ŒConcurrentHashMapéƒ½æ˜¯åŸºäºSegmentåˆ†æ®µé”æ¥å®ç°çš„ï¼Œåœ¨JDK8ä»¥åï¼Œå°±æ¢æˆsynchronizedå’ŒCASè¿™å¥—å®ç°æœºåˆ¶äº†ã€‚</p>
</li>
</ul>
<p>JDK1.8ä¸­çš„ConcurrentHashMapä¸­ä»ç„¶å­˜åœ¨Segmentè¿™ä¸ªç±»ï¼Œè€Œè¿™ä¸ªç±»çš„å£°æ˜åˆ™æ˜¯ä¸ºäº†å…¼å®¹ä¹‹å‰çš„ç‰ˆæœ¬åºåˆ—åŒ–è€Œå­˜åœ¨çš„ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * Stripped-down version of helper class used in previous version,</span></span><br><span class="line"><span class="comment">  * declared for the sake of serialization compatibility.</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Segment</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">ReentrantLock</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">2249069246763182397L</span>;</span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">float</span> loadFactor;</span><br><span class="line">     Segment(<span class="keyword">float</span> lf) &#123; <span class="keyword">this</span>.loadFactor = lf; &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p>JDK1.8ä¸­çš„ConcurrentHashMapä¸å†ä½¿ç”¨Segmentåˆ†æ®µé”ï¼Œè€Œæ˜¯ä»¥tableæ•°ç»„çš„å¤´ç»“ç‚¹ä½œä¸ºsynchronizedçš„é”ã€‚å’ŒJDK1.8ä¸­çš„HashMapç±»ä¼¼ï¼Œå¯¹äºhashCodeç›¸åŒçš„æ—¶å€™ï¼Œåœ¨NodeèŠ‚ç‚¹çš„æ•°é‡å°‘äº8ä¸ªæ—¶ï¼Œè¿™æ—¶çš„Nodeå­˜å‚¨ç»“æ„æ˜¯é“¾è¡¨å½¢å¼ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(N)ï¼Œå½“NodeèŠ‚ç‚¹çš„ä¸ªæ•°è¶…è¿‡8ä¸ªæ—¶ï¼Œåˆ™ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œæ­¤æ—¶è®¿é—®çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(long(N))ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * The array of bins. Lazily initialized upon first insertion.</span></span><br><span class="line"><span class="comment">    * Size is always a power of two. Accessed directly by iterators.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">transient</span> <span class="keyword">volatile</span> Node&lt;K,V&gt;[] table;</span><br></pre></td></tr></table></figure></p>
<p>æ•°æ®ç»“æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://raw.githubusercontent.com/JasonGaoH/KnowledgeSummary/master/Docs/img/concurrenthashmap.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<p>å…¶å®ConcurrentHashMapä¿è¯çº¿ç¨‹å®‰å…¨ä¸»è¦æœ‰ä¸‰ä¸ªåœ°æ–¹ã€‚</p>
<blockquote>
<ul>
<li>ä¸€ã€ä½¿ç”¨volatileä¿è¯å½“Nodeä¸­çš„å€¼å˜åŒ–æ—¶å¯¹äºå…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„</li>
<li>äºŒã€ä½¿ç”¨tableæ•°ç»„çš„å¤´ç»“ç‚¹ä½œä¸ºsynchronizedçš„é”æ¥ä¿è¯å†™æ“ä½œçš„å®‰å…¨</li>
<li>ä¸‰ã€å½“å¤´ç»“ç‚¹ä¸ºnullæ—¶ï¼Œä½¿ç”¨CASæ“ä½œæ¥ä¿è¯æ•°æ®èƒ½æ­£ç¡®çš„å†™å…¥ã€‚</li>
</ul>
</blockquote>
<h3 id="ä½¿ç”¨volatile"><a href="#ä½¿ç”¨volatile" class="headerlink" title="ä½¿ç”¨volatile"></a>ä½¿ç”¨volatile</h3><p>å¯ä»¥çœ‹åˆ°ï¼ŒNodeä¸­çš„valå’Œnextéƒ½è¢«volatileå…³é”®å­—ä¿®é¥°ã€‚</p>
<blockquote>
<p>volatileçš„happens-beforeè§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileå˜é‡çš„å†™ä¸€å®šå¯è§ï¼ˆhappens-before)äºéšåå¯¹å®ƒçš„è¯»ã€‚</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ”¹åŠ¨valçš„å€¼æˆ–è€…nextçš„å€¼å¯¹äºå…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ï¼Œå› ä¸ºvolatileå…³é”®å­—ï¼Œä¼šåœ¨è¯»æŒ‡ä»¤å‰æ’å…¥è¯»å±éšœï¼Œå¯ä»¥è®©é«˜é€Ÿç¼“å­˜ä¸­çš„æ•°æ®å¤±æ•ˆï¼Œé‡æ–°ä»ä¸»å†…å­˜åŠ è½½æ•°æ®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">        <span class="keyword">final</span> K key;</span><br><span class="line">        <span class="keyword">volatile</span> V val;</span><br><span class="line">        <span class="keyword">volatile</span> Node&lt;K,V&gt; next;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ï¼ŒConcurrentHashMapæä¾›ç±»ä¼¼tabAtæ¥è¯»å–Tableæ•°ç»„ä¸­çš„å…ƒç´ ï¼Œè¿™é‡Œæ˜¯ä»¥volatileè¯»çš„æ–¹å¼è¯»å–tableæ•°ç»„ä¸­çš„å…ƒç´ ï¼Œä¸»è¦é€šè¿‡Unsafeè¿™ä¸ªç±»æ¥å®ç°çš„ï¼Œä¿è¯å…¶ä»–çº¿ç¨‹æ”¹å˜äº†è¿™ä¸ªæ•°ç»„ä¸­çš„å€¼çš„æƒ…å†µä¸‹ï¼Œåœ¨å½“å‰çº¿ç¨‹getçš„æ—¶å€™èƒ½æ‹¿åˆ°ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> &lt;K,V&gt; <span class="function">Node&lt;K,V&gt; <span class="title">tabAt</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> (Node&lt;K,V&gt;)U.getObjectVolatile(tab, ((<span class="keyword">long</span>)i &lt;&lt; ASHIFT) + ABASE);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>è€Œä¸ä¹‹å¯¹åº”çš„ï¼Œæ˜¯setTabAt,è¿™é‡Œæ˜¯ä»¥volatileå†™çš„æ–¹å¼å¾€æ•°ç»„å†™å…¥å…ƒç´ ï¼Œè¿™æ ·èƒ½ä¿è¯ä¿®æ”¹åèƒ½å¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> &lt;K,V&gt; <span class="function"><span class="keyword">void</span> <span class="title">setTabAt</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> i, Node&lt;K,V&gt; v)</span> </span>&#123;</span><br><span class="line">       U.putObjectVolatile(tab, ((<span class="keyword">long</span>)i &lt;&lt; ASHIFT) + ABASE, v);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸‹ConcurrentHashMapçš„putValæ–¹æ³•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Implementation for put and putIfAbsent */</span></span><br><span class="line">  <span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(K key, V value, <span class="keyword">boolean</span> onlyIfAbsent)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (key == <span class="keyword">null</span> || value == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">      <span class="keyword">int</span> hash = spread(key.hashCode());</span><br><span class="line">      <span class="keyword">int</span> binCount = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> (Node&lt;K,V&gt;[] tab = table;;) &#123;</span><br><span class="line">          Node&lt;K,V&gt; f; <span class="keyword">int</span> n, i, fh;</span><br><span class="line">          <span class="keyword">if</span> (tab == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">              tab = initTable();</span><br><span class="line">          <span class="comment">//å½“å¤´ç»“ç‚¹ä¸ºnull,åˆ™é€šè¿‡casTabAtæ–¹å¼å†™å…¥</span></span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> ((f = tabAt(tab, i = (n - <span class="number">1</span>) &amp; hash)) == <span class="keyword">null</span>) &#123;</span><br><span class="line">              <span class="keyword">if</span> (casTabAt(tab, i, <span class="keyword">null</span>,</span><br><span class="line">                           <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key, value, <span class="keyword">null</span>)))</span><br><span class="line">                  <span class="keyword">break</span>;                   <span class="comment">// no lock when adding to empty bin</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> ((fh = f.hash) == MOVED)</span><br><span class="line">            <span class="comment">//æ­£åœ¨æ‰©å®¹</span></span><br><span class="line">              tab = helpTransfer(tab, f);</span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">              V oldVal = <span class="keyword">null</span>;</span><br><span class="line">              <span class="comment">//å¤´ç»“ç‚¹ä¸ä¸ºnullï¼Œä½¿ç”¨synchronizedåŠ é”</span></span><br><span class="line">              <span class="keyword">synchronized</span> (f) &#123;</span><br><span class="line">                  <span class="keyword">if</span> (tabAt(tab, i) == f) &#123;</span><br><span class="line">                      <span class="keyword">if</span> (fh &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                          <span class="comment">//æ­¤æ—¶hashæ¡¶æ˜¯é“¾è¡¨ç»“æ„</span></span><br><span class="line">                          binCount = <span class="number">1</span>;</span><br><span class="line">                          <span class="keyword">for</span> (Node&lt;K,V&gt; e = f;; ++binCount) &#123;</span><br><span class="line">                              K ek;</span><br><span class="line">                              <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                                  ((ek = e.key) == key ||</span><br><span class="line">                                   (ek != <span class="keyword">null</span> &amp;&amp; key.equals(ek)))) &#123;</span><br><span class="line">                                  oldVal = e.val;</span><br><span class="line">                                  <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                      e.val = value;</span><br><span class="line">                                  <span class="keyword">break</span>;</span><br><span class="line">                              &#125;</span><br><span class="line">                              Node&lt;K,V&gt; pred = e;</span><br><span class="line">                              <span class="keyword">if</span> ((e = e.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                                  pred.next = <span class="keyword">new</span> Node&lt;K,V&gt;(hash, key,</span><br><span class="line">                                                            value, <span class="keyword">null</span>);</span><br><span class="line">                                  <span class="keyword">break</span>;</span><br><span class="line">                              &#125;</span><br><span class="line">                          &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">                      <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> TreeBin) &#123;</span><br><span class="line">                          <span class="comment">//æ­¤æ—¶æ˜¯çº¢é»‘æ ‘</span></span><br><span class="line">                          Node&lt;K,V&gt; p;</span><br><span class="line">                          binCount = <span class="number">2</span>;</span><br><span class="line">                          <span class="keyword">if</span> ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key,</span><br><span class="line">                                                         value)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                              oldVal = p.val;</span><br><span class="line">                              <span class="keyword">if</span> (!onlyIfAbsent)</span><br><span class="line">                                  p.val = value;</span><br><span class="line">                          &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">                      <span class="keyword">else</span> <span class="keyword">if</span> (f <span class="keyword">instanceof</span> ReservationNode)</span><br><span class="line">                          <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Recursive update"</span>);</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span> (binCount != <span class="number">0</span>) &#123;</span><br><span class="line">                  <span class="comment">//å½“é“¾è¡¨ç»“æ„å¤§äºç­‰äº8ï¼Œåˆ™å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">                  <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD)</span><br><span class="line">                      treeifyBin(tab, i);</span><br><span class="line">                  <span class="keyword">if</span> (oldVal != <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">return</span> oldVal;</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      addCount(<span class="number">1L</span>, binCount);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨putValæ–¹æ³•é‡è¦çš„åœ°æ–¹éƒ½åŠ äº†æ³¨é‡Šï¼Œå¯ä»¥å¸®åŠ©ç†è§£ï¼Œç°åœ¨æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥çœ‹putValæ–¹æ³•ã€‚</p>
<h3 id="ä½¿ç”¨CAS"><a href="#ä½¿ç”¨CAS" class="headerlink" title="ä½¿ç”¨CAS"></a>ä½¿ç”¨CAS</h3><p>å½“æœ‰ä¸€ä¸ªæ–°çš„å€¼éœ€è¦putåˆ°ConcurrentHashMapä¸­æ—¶ï¼Œé¦–å…ˆä¼šéå†ConcurrentHashMapçš„tableæ•°ç»„ï¼Œç„¶åæ ¹æ®keyçš„hashCodeæ¥å®šä½åˆ°éœ€è¦å°†è¿™ä¸ªvalueæ”¾åˆ°æ•°ç»„çš„å“ªä¸ªä½ç½®ã€‚</p>
<p><code>tabAt(tab, i = (n - 1) &amp; hash))</code>å°±æ˜¯å®šä½åˆ°è¿™ä¸ªæ•°ç»„çš„ä½ç½®ï¼Œå¦‚æœå½“å‰è¿™ä¸ªä½ç½®çš„Nodeä¸ºnullï¼Œåˆ™é€šè¿‡CASæ–¹å¼çš„æ–¹æ³•å†™å…¥ã€‚æ‰€è°“çš„CASï¼Œå³å³compareAndSwapï¼Œæ‰§è¡ŒCASæ“ä½œçš„æ—¶å€™ï¼Œå°†å†…å­˜ä½ç½®çš„å€¼ä¸é¢„æœŸåŸå€¼æ¯”è¾ƒï¼Œå¦‚æœç›¸åŒ¹é…ï¼Œé‚£ä¹ˆå¤„ç†å™¨ä¼šè‡ªåŠ¨å°†è¯¥ä½ç½®å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œå¦åˆ™ï¼Œå¤„ç†å™¨ä¸åšä»»ä½•æ“ä½œã€‚</p>
<p>è¿™é‡Œå°±æ˜¯è°ƒç”¨casTabAtæ–¹æ³•æ¥å®ç°çš„ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">static</span> <span class="keyword">final</span> &lt;K,V&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">casTabAt</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> i,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    Node&lt;K,V&gt; c, Node&lt;K,V&gt; v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> U.compareAndSwapObject(tab, ((<span class="keyword">long</span>)i &lt;&lt; ASHIFT) + ABASE, c, v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>casTabAtåŒæ ·æ˜¯é€šè¿‡è°ƒç”¨Unsafeç±»æ¥å®ç°çš„ï¼Œè°ƒç”¨Unsafeçš„compareAndSwapObjectæ¥å®ç°ï¼Œå…¶å®å¦‚æœä»”ç»†å»è¿½è¸ªè¿™æ¡çº¿è·¯ï¼Œä¼šå‘ç°å…¶å®æœ€ç»ˆè°ƒç”¨çš„æ˜¯cmpxchgè¿™ä¸ªCPUæŒ‡ä»¤æ¥å®ç°çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªCPUçš„åŸå­æŒ‡ä»¤ï¼Œèƒ½ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§é—®é¢˜ã€‚</p>
<h3 id="ä½¿ç”¨synchronized"><a href="#ä½¿ç”¨synchronized" class="headerlink" title="ä½¿ç”¨synchronized"></a>ä½¿ç”¨synchronized</h3><p>å½“å¤´ç»“ç‚¹ä¸ä¸ºnullæ—¶ï¼Œåˆ™ä½¿ç”¨è¯¥å¤´ç»“ç‚¹åŠ é”ï¼Œè¿™æ ·å°±èƒ½å¤šçº¿ç¨‹å»put hashCodeç›¸åŒçš„æ—¶å€™ä¸ä¼šå‡ºç°æ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚synchronizedæ˜¯äº’æ–¥é”ï¼Œæœ‰ä¸”åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ‹¿åˆ°è¿™ä¸ªé”ï¼Œä»è€Œä¿è¯äº†putæ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>ä¸‹é¢æ˜¯ConcurrentHashMapçš„putæ“ä½œçš„ç¤ºæ„å›¾ï¼Œå›¾ç‰‡æ¥è‡ªäº<a href="https://www.jianshu.com/p/5bc70d9e5410" target="_blank" rel="noopener">ConcurrentHashMapæºç åˆ†æ(JDK8)get/put/removeæ–¹æ³•åˆ†æ</a>ã€‚<br><img src="https://raw.githubusercontent.com/JasonGaoH/KnowledgeSummary/master/Docs/img/concurrenthashmap_put.webp" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p>
<h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><p><a href="http://www.jasongj.com/java/concurrenthashmap/" target="_blank" rel="noopener">ä»ConcurrentHashMapçš„æ¼”è¿›çœ‹Javaå¤šçº¿ç¨‹æ ¸å¿ƒæŠ€æœ¯</a></p>
<p><a href="https://www.jianshu.com/p/5bc70d9e5410" target="_blank" rel="noopener">ConcurrentHashMapæºç åˆ†æ(JDK8)get/put/removeæ–¹æ³•åˆ†æ</a></p>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#ConcurrentHashMap">
    <span class="tag-code">ConcurrentHashMap</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2020/05/21/æˆ‘ç”»äº†è¿‘ç™¾å¼ å›¾æ¥ç†è§£çº¢é»‘æ ‘/">
        <span class="nav-arrow">â† </span>
        
          æˆ‘ç”»äº†è¿‘ç™¾å¼ å›¾æ¥ç†è§£çº¢é»‘æ ‘
        
      </a>
    
    
      <a class="nav-right" href="/2020/05/21/å…³äºHashMapä½ éœ€è¦çŸ¥é“çš„ä¸€äº›ç»†èŠ‚/">
        
          å…³äºHashMapä½ éœ€è¦çŸ¥é“çš„ä¸€äº›ç»†èŠ‚
        
        <span class="nav-arrow"> â†’</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- æ‰“èµ START -->
    
    <!-- æ‰“èµ END -->
    <!-- äºŒç»´ç  START -->
    
      <div class="qrcode"></div>
      <p class="notice">å…¬ä¼—å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ˜„</p>
    
    <!-- äºŒç»´ç  END -->
    
      <!-- Utterances START -->
      <div id="utterances"></div>
      <script src="https://utteranc.es/client.js" repo="JasonGaoH/RepoForUtterances" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>    
      <!-- Utterances END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
  <!-- Catalog END -->

</main>

<script>
  (function () {
    var url = 'JasonGaoH.github.io/2020/05/21/ConcurrentHashMapæ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', '/css/images/error_icon.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== '/css/images/error_icon.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>







    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2023 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    
    

    <br>
    æœ¬ç«™ç´¯è®¡è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>,
    æœ¬ç«™ç´¯è®¡è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>
  </p>
</footer>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      hljs.configure({useBR: true});
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>

  </body>
</html>