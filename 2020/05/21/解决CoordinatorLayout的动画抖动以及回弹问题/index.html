<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="åšæŒè¾“å‡ºï¼ŒåšæŒä¹¦å†™ï¼Œæ‰å¯ä»¥æŒç»­æˆé•¿">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      è§£å†³CoordinatorLayoutçš„åŠ¨ç”»æŠ–åŠ¨ä»¥åŠå›å¼¹é—®é¢˜ | JasonGao Thoughts
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    <script src="/js/qrious.js"></script>
  
  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


  
  
    <script src="/js/local-search.js"></script>

<link rel="alternate" href="atom.xml" title="JasonGao Thoughts" type="application/atom+xml">
</head>
<div class="wechat-share">
  <img src="/css/images/logo.png">
</div>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>JasonGao Thoughts</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/links/" class="item-link">Links</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
      
      <li class="menu-item menu-item-rss right-list">
    <a href="/atom.xml">
      <i class="fa fa-rss fa-fw"></i>
    </a>
  </li>
      
        <li class="menu-item menu-item-search right-list">
    <a role="button" class="popup-trigger">
        <i class="fa fa-search fa-fw"></i>
    </a>
</li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/links/" class="menu-link">Links</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
    
      <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
            <span class="search-icon">
                <i class="fa fa-search"></i>
            </span>
            <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="Please enter your keyword(s) to search." spellcheck="false" type="search" class="search-input">
            </div>
            <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>
    
  </div>
</header>

    <div id="article-banner">
  <h2>è§£å†³CoordinatorLayoutçš„åŠ¨ç”»æŠ–åŠ¨ä»¥åŠå›å¼¹é—®é¢˜</h2>
  <p class="post-date">2020-05-21</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><p>åœ¨ä½¿ç”¨CoordinatorLayoutæ¥å®ç°Androidä¸­çš„ä¸€ç§å¸é¡¶çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸¤ä¸ªCoordinatorLayoutçš„æ»‘åŠ¨é—®é¢˜ï¼Œè¿™é‡Œåšä¸‹è®°å½•ã€‚</p>
<p>è¿™é‡Œä½¿ç”¨CoordinatorLayoutå®ç°çš„æ˜¯ä¸€ä¸ªtabå¸é¡¶çš„æ•ˆæœï¼Œç±»ä¼¼æ·˜å®ï¼Œäº¬ä¸œé¦–é¡µçš„ä¸€ä¸ªæ•ˆæœã€‚<br>å¤´éƒ¨åŒºåŸŸå±•ç¤ºå„ç§ç±»å‹bannerå¡ç‰‡ï¼Œä¸­é—´æ˜¯ç±»ä¼¼TabLayoutçš„å¯ç‚¹å‡»tabï¼Œä¸‹é¢æ˜¯feedå¡ç‰‡ï¼Œå¯ä»¥ä¸€ç›´ä¸‹æ‹‰åŠ è½½ï¼Œå¹¶ä¸”feedå¡ç‰‡åŒºåŸŸä½¿ç”¨ViewPagerå¯ä»¥æ”¯æŒå·¦å³æ¨ªæ»‘åˆ‡æ¢tabï¼Œå¦å¤–ï¼Œå°±æ˜¯tabæ»šåŠ¨åˆ°é¡¶éƒ¨ä¹‹åä¼šæœ‰ä¸ªå¸é¡¶çš„æ•ˆæœã€‚</p>
 <a id="more"></a>
<p>æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä¹Ÿè¦å®ç°çš„æ•ˆæœï¼Œä¸€å¼€å§‹æˆ‘çš„æƒ³æ³•æ˜¯ä½¿ç”¨åµŒå¥—RecycleViewçš„å½¢å¼æ¥å®ç°ï¼Œå› ä¸ºæˆ‘å»è°ƒç ”äº†ä¸‹äº¬ä¸œå’Œæ·˜å®çš„é¦–é¡µå¸ƒå±€éƒ½æ˜¯è¿™ä¹ˆå®ç°çš„ï¼Œäº¬ä¸œå’Œæ·˜å®é¦–é¡µå®ç°æ–¹å¼å’Œä¸‹é¢çš„å›¾ç±»ä¼¼ï¼Œå¤–éƒ¨çš„æ•´ä¸ªRecycleViewåµŒå¥—ViewPagerï¼ŒViewPagerä¸­å†æœ‰å¤šä¸ªRecycleViewï¼Œè¿™ä¸ªå®ç°èµ·æ¥ç¨å¾®æœ‰ç‚¹éº»çƒ¦ï¼Œéš¾ç‚¹æ˜¯è¦å¤„ç†å¥½å¤–éƒ¨çš„RecycleViewå’ŒViewPagerä¸­å†…éƒ¨RecycleViewçš„æ»‘åŠ¨äº‹ä»¶ä¼ é€’ï¼Œè¿™é‡Œæˆ‘ä»¬åªæ˜¯ç®€å•ä»‹ç»ä¸‹ï¼Œåé¢æˆ‘ä¼šä¸“é—¨æ¥ä»‹ç»ç±»ä¼¼è¿™æ ·çš„åµŒå¥—RecycleViewå¦‚ä½•å®ç°ã€‚</p>
<p><img src="https://raw.githubusercontent.com/JasonGaoH/Images/master/nested_recycler_view.png" alt="image"></p>
<p>æ¥ä¸‹æ¥æ˜¯å¦‚ä½•é‡‡ç”¨å…¶ä»–æ–¹ä¾¿çš„æ–¹å¼æ¥å®ç°ç±»ä¼¼éœ€æ±‚ï¼Ÿæˆ‘æƒ³åˆ°äº†CoordinatorLayoutï¼ŒCoordinatorLayoutåœ¨å¤„ç†å¸é¡¶æ˜¯æœ‰ä¸€å¥—å·²ç»æˆç†Ÿçš„æ–¹æ¡ˆçš„ã€‚</p>
<p>ç½‘ä¸Šå…³äºCoordinatorLayoutçš„ä½¿ç”¨æœ‰å¾ˆå¤šä¸é”™çš„æ–‡ç« ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»å¦‚ä½•ä½¿ç”¨ï¼Œå…³äºCoordinatorLayoutå’ŒBehavioræˆ‘æ¨èçœ‹çœ‹è¿™ç¯‡æ–‡ç« <a href="https://blog.csdn.net/briblue/article/details/73076458" target="_blank" rel="noopener">é’ˆå¯¹ CoordinatorLayout åŠ Behavior çš„ä¸€æ¬¡ç»†èŠ‚è¾ƒçœŸ</a></p>
<p>è€Œæˆ‘ä»¬è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®²ä½¿ç”¨CoordinatorLayoutä¸­é‡åˆ°çš„é—®é¢˜ï¼Œé—®é¢˜å¦‚ä½•è§£å†³ä»¥åŠCoordinatorLayoutä¸ºä»€ä¹ˆä¼šæœ‰è¿™æ ·çš„é—®é¢˜ã€‚</p>
<p><img src="https://raw.githubusercontent.com/JasonGaoH/Images/master/CoordinatorLayout.png" alt="image"></p>
<p>å®ç°è¿™ä¸ªå¤§æ¦‚æ˜¯åƒä¸Šé¢è¿™æ ·ç±»ä¼¼çš„å¸ƒå±€ç»“æ„ï¼Œæ¥çœ‹ä¸‹å¸ƒå±€æ–‡ä»¶ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;android.support.design.widget.CoordinatorLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;match_parent&quot;</span><br><span class="line">    tools:context=&quot;.MainActivity&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.design.widget.AppBarLayout</span><br><span class="line">        app:layout_scrollFlags=&quot;scroll&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;android.support.design.widget.CollapsingToolbarLayout</span><br><span class="line">            app:layout_scrollFlags=&quot;scroll&quot;</span><br><span class="line">            app:scrimVisibleHeightTrigger=&quot;45dp&quot;</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;&gt;</span><br><span class="line"></span><br><span class="line">            &lt;ImageView</span><br><span class="line">                android:background=&quot;@drawable/header&quot;</span><br><span class="line">                app:layout_scrollFlags=&quot;scroll&quot;</span><br><span class="line">                android:layout_width=&quot;match_parent&quot;</span><br><span class="line">                android:layout_height=&quot;450dp&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/android.support.design.widget.CollapsingToolbarLayout&gt;</span><br><span class="line"></span><br><span class="line">        &lt;android.support.design.widget.TabLayout</span><br><span class="line">            android:id=&quot;@+id/tabs&quot;</span><br><span class="line">            app:layout_collapseMode=&quot;pin&quot;</span><br><span class="line">            app:tabMode=&quot;scrollable&quot;</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/android.support.design.widget.AppBarLayout&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;android.support.v4.view.ViewPager</span><br><span class="line">        android:id=&quot;@+id/view_pager&quot;</span><br><span class="line">        app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/android.support.design.widget.CoordinatorLayout&gt;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„å¸ƒå±€ï¼Œæ¥ç€å¡«å……æ•°æ®åŸºæœ¬ä¸Šå°±èƒ½å®ç°tabå¸é¡¶æ•ˆæœï¼Œfeedå¡ç‰‡åŒºé‡‡ç”¨RecycleViewå®ç°ï¼Œå¯ä»¥ä¸€ç›´ä¸‹æ‹‰ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ”¯æŒå·¦å³æ¨ªæ»‘ï¼ŒåŸºæœ¬å®ç°äº†ç±»ä¼¼äº¬ä¸œï¼Œæ·˜å®é¦–é¡µçš„ä¸€ä¸ªæ•ˆæœã€‚</p>
<p>ä½†æ˜¯åœ¨ä½¿ç”¨è¿™ç§æ–¹å¼æ¥å®ç°å‘ç°ä¸¤ä¸ªå¾ˆæ˜æ˜¾çš„é—®é¢˜ã€‚</p>
<h4 id="ç¬¬ä¸€ï¼ŒæŠ–åŠ¨é—®é¢˜"><a href="#ç¬¬ä¸€ï¼ŒæŠ–åŠ¨é—®é¢˜" class="headerlink" title="ç¬¬ä¸€ï¼ŒæŠ–åŠ¨é—®é¢˜"></a>ç¬¬ä¸€ï¼ŒæŠ–åŠ¨é—®é¢˜</h4><p>è¯¥é—®é¢˜åœºæ™¯æè¿°ï¼šæˆ‘ä»¬è§¦æ‘¸AppBarLayoutä½¿AppBarLayoutæ•´ä½“å‘ä¸Šæ»‘åŠ¨ï¼Œï¼Œå³æ‰‹æŒ‡ä¸Šæ»‘ï¼Œå½“AppBarLayout flingçš„åŒæ—¶ï¼Œæˆ‘ä»¬è§¦æ‘¸ä¸‹éƒ¨ViewPagerä¸­çš„RecycleViewåŒºåŸŸï¼Œä½¿RecycleViewåŒºåŸŸæ•´ä½“å‘ä¸‹æ»‘åŠ¨ï¼Œå³æ‰‹æŒ‡ä¸‹æ»‘ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå‘ç°ä¸€ä¸ªæ˜æ˜¾é¡µé¢åŠ¨ç”»ç°è±¡ï¼Œè¿™ä¸ªé—®é¢˜å‡ ä¹æ˜¯å¿…ç°ã€‚</p>
<p>æ¥çœ‹ä¸‹gifæ•ˆæœï¼š<img src="https://raw.githubusercontent.com/JasonGaoH/Images/master/coordinator_resize_1.gif" alt="image"></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹é—®é¢˜çš„åŸå› ï¼Œå…¶å®è¿™ä¸ªè¦ææ¸…æ¥šåŸå› éœ€è¦å¯¹CoordinatorLayoutçš„å·¥ä½œæœºåˆ¶æœ‰ä¸ªæ¯”è¾ƒæ¸…æ™°çš„ç†è§£ï¼Œç„¶è€ŒCoordinatorLayoutè¿™é‡Œç‰µæ‰¯åˆ°åµŒå¥—æ»šåŠ¨ä»¥åŠBehaviorè¿™äº›ï¼Œ</p>
<p>æˆ‘ä»¬è¿™é‡Œå°è¯•ç®€å•åœ°ä»‹ç»ä¸‹CoordinatorLayoutçš„å·¥ä½œæœºåˆ¶ã€‚</p>
<p><img src="https://raw.githubusercontent.com/JasonGaoH/Images/master/coordinatorLayout_analysis.png" alt="image"></p>
<ul>
<li>CoordinatorLayoutå®ç°NestedScrollingParent2æ¥å£ï¼Œç”¨äºå¤„ç†ä¸æ»‘åŠ¨å­Viewçš„è”åŠ¨äº¤äº’ï¼Œå®é™…ä¸Šäº¤ç”±Behaviorè¿›è¡Œå¤„ç†ã€‚</li>
<li>AppBarLayoutä¸­é»˜è®¤ä½¿ç”¨äº†AppBarLayout.Behaviorï¼Œä¸»è¦åŠŸèƒ½æ˜¯æ¥æ”¶CoordinatorLayoutä¼ è¾“è¿‡æ¥çš„æ»‘åŠ¨äº‹ä»¶ï¼Œå¹¶ä¸”ç›¸å¯¹åº”çš„è¿›è¡Œå¤„ç†ï¼Œå¦‚RecycleViewå¾€ä¸Šæ»‘åŠ¨åˆ°å¤´æ—¶å€™ï¼Œç»§ç»­æ»‘åŠ¨ç§»åŠ¨AppBarLayoutåˆ°å¤´ã€‚</li>
<li>RecycleViewå®ç°äº†NestedScrollingChild2æ¥å£ï¼Œç”¨äºä¼ è¾“ç»™CoordinatorLayoutï¼Œå¹¶ä¸”æ¶ˆè´¹CoordinatorLayoutä¸æ¶ˆè´¹çš„è§¦æ‘¸äº‹ä»¶ï¼Œå…¶ä¸­è¿˜æ˜¯ä½¿ç”¨äº†AppBarLayout.ScrollingViewBehaviorï¼ŒåŠŸèƒ½æ˜¯è¿›è¡Œç›‘å¬AppBarLayoutçš„ä½ç§»å˜åŒ–ï¼Œä»è€Œè¿›è¡Œç›¸å¯¹åº”çš„å˜åŒ–ï¼Œæœ€æ˜æ˜¾çš„ä¾‹å­å°±æ˜¯AppBarLayoutä¸Šç§»è¿‡ç¨‹ä¸­ï¼ŒRecycleViewä¸€èµ·ä¸Šç§»ã€‚</li>
</ul>
<h4 id="CoordinatorLayoutä¸­Behavior"><a href="#CoordinatorLayoutä¸­Behavior" class="headerlink" title="CoordinatorLayoutä¸­Behavior"></a>CoordinatorLayoutä¸­Behavior</h4><p>å…¶å®CoordinatorLayoutå°±æ˜¯é€šè¿‡Behaviorè¿™ä¸ªæœºåˆ¶æ¥åè°ƒå„ä¸ªå­Viewçš„æ»šåŠ¨ã€‚æ¯”å¦‚æˆ‘ä»¬æ¥çœ‹CoordinatorLayoutçš„onStartNestedScrollæ–¹æ³•ï¼Œè¿™ä¸ªå…¶å®æ˜¯NestedScrollingParent2ä¸­çš„æ–¹æ³•ã€‚</p>
<p>å½“CoordinatorLayoutå­viewçš„è°ƒç”¨NestedScrollingChild2çš„æ–¹æ³•startNestedScrollæ—¶,ä¼šè°ƒç”¨åˆ°è¯¥æ–¹æ³•<br>è¯¥æ–¹æ³•å†³å®šäº†å½“å‰æ§ä»¶æ˜¯å¦èƒ½æ¥æ”¶åˆ°å…¶å†…éƒ¨Viewï¼ˆå¹¶éæ˜¯ç›´æ¥å­Viewï¼‰æ»‘åŠ¨æ—¶çš„å‚æ•°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">//CoordinatorLayoutä¸­çš„onStartNestedScrollæ–¹æ³•ï¼š</span><br><span class="line"> @Override</span><br><span class="line">    public boolean onStartNestedScroll(View child, View target, int nestedScrollAxes) &#123;</span><br><span class="line">        return onStartNestedScroll(child, target, nestedScrollAxes, ViewCompat.TYPE_TOUCH);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onStartNestedScroll(View child, View target, int axes, int type) &#123;</span><br><span class="line">        boolean handled = false;</span><br><span class="line"></span><br><span class="line">        final int childCount = getChildCount();</span><br><span class="line">        for (int i = 0; i &lt; childCount; i++) &#123;</span><br><span class="line">            final View view = getChildAt(i);</span><br><span class="line">            if (view.getVisibility() == View.GONE) &#123;</span><br><span class="line">                // If it&apos;s GONE, don&apos;t dispatch</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line">            final LayoutParams lp = (LayoutParams) view.getLayoutParams();</span><br><span class="line">            final Behavior viewBehavior = lp.getBehavior();</span><br><span class="line">            if (viewBehavior != null) &#123;</span><br><span class="line">                final boolean accepted = viewBehavior.onStartNestedScroll(this, view, child,</span><br><span class="line">                        target, axes, type);</span><br><span class="line">                handled |= accepted;</span><br><span class="line">                lp.setNestedScrollAccepted(type, accepted);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                lp.setNestedScrollAccepted(type, false);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return handled;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>CoordinatorLayoutä¸­çš„onStartNestedScrollæ–¹æ³•åŸºæœ¬éƒ½ä¼šè°ƒç”¨åˆ°æ¯ä¸ªå­Viewçš„Behaviorä¸­ç›¸åº”çš„æ–¹æ³•ä¸­å»ã€‚</p>
<p>å…³äºNestedåµŒå¥—æ»šåŠ¨æœºåˆ¶å¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™ç¯‡åšå®¢ã€‚</p>
<p><a href="https://blog.csdn.net/aishang5wpj/article/details/78873343" target="_blank" rel="noopener">äº‹ä»¶åˆ†å‘å’ŒNestedScrolling</a></p>
<p>åµŒå¥—æ»šåŠ¨æœºåˆ¶NestedScrollingParent2å’ŒNestedScrollingChild2çš„å„ä¸ªå›è°ƒæ–¹æ³•è°ƒç”¨æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://raw.githubusercontent.com/JasonGaoH/Images/master/nested.jpeg" alt="image"></p>
<p>ä¸Šå›¾åˆ—å‡ºæ¥æ‰‹æŒ‡ä»æŒ‰ä¸‹åˆ°æŠ¬èµ·æ—¶çš„æ•´ä¸ªæµç¨‹ï¼Œå½“ç„¶è¿™äº›éƒ½æ˜¯åœ¨å­Viewçš„onTouchEvent()ä¸­å®Œæˆçš„ï¼Œæ‰€ä»¥çˆ¶Viewä¸€å®šä¸èƒ½æ‹¦æˆªå­Viewçš„äº‹ä»¶ï¼Œå¦åˆ™è¿™å¥—æœºåˆ¶å°±å¤±æ•ˆäº†ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œç®­å¤´çš„å·¦è¾¹åˆ†åˆ«éƒ½æ˜¯NestedScrollingChild2ä¸­çš„å„ç§æ–¹æ³•ï¼Œå³è¾¹åˆ™æ˜¯NestedScrollingParent2å¯¹åº”çš„æ–¹æ³•ã€‚ä½¿ç”¨æ—¶ï¼Œä¸€èˆ¬æ˜¯å­Viewé€šè¿‡dispatchXXX()æ¥é€šçŸ¥çˆ¶Viewï¼Œç„¶åçˆ¶Viewé€šè¿‡onXXX()æ¥è¿›è¡Œå›åº”ã€‚</p>
<p>æ–¹æ³•è°ƒç”¨çš„å…ˆåæ—¶æœºä¹Ÿæœ‰åŒºåˆ«ï¼Œå¯¹åº”åˆ°ä¸Šå›¾ä¸­ï¼Œå›¾è¶Šå¾€ä¸‹ï¼Œè°ƒç”¨çš„æ—¶æœºè¶Šæ™šã€‚</p>
<h4 id="AppBarLayoutä¸­çš„Behavior"><a href="#AppBarLayoutä¸­çš„Behavior" class="headerlink" title="AppBarLayoutä¸­çš„Behavior"></a>AppBarLayoutä¸­çš„Behavior</h4><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹çœ‹AppBarLayoutä¸­çš„Behaviorï¼ŒApprBarLayoutçš„é»˜è®¤Behaviorå°±æ˜¯AppBarLayout.Behaviorè¿™ä¸ªç±»ï¼Œè€ŒAppBarLayout.Behaviorç»§æ‰¿è‡ªHeaderBehaviorï¼ŒHeaderBehavioråˆç»§æ‰¿è‡ªViewOffsetBehaviorï¼Œè¿™é‡Œå…ˆæ€»ç»“ä¸€ä¸‹ä¸¤ä¸ªç±»çš„ä½œç”¨ã€‚</p>
<ul>
<li>ViewOffsetBehaviorï¼šè¯¥Behaviorä¸»è¦è¿ç”¨äºViewçš„ç§»åŠ¨ï¼Œä»åå­—å°±å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¯¥ç±»ä¸­æä¾›äº†ä¸Šä¸‹ç§»åŠ¨ï¼Œå·¦å³ç§»åŠ¨çš„æ–¹æ³•ã€‚</li>
<li>HeaderBehaviorï¼šè¯¥ç±»ä¸»è¦ç”¨äºViewå¤„ç†è§¦æ‘¸äº‹ä»¶ä»¥åŠè§¦æ‘¸åçš„flingäº‹ä»¶ã€‚</li>
</ul>
<p>ç”±äºä¸Šé¢ä¸¤ä¸ªç±»åŠŸèƒ½çš„å®ç°ï¼Œä½¿å¾—AppBarLayout.Behaviorå…·æœ‰äº†åŒæ—¶ç§»åŠ¨æœ¬èº«ä»¥åŠå¤„ç†è§¦æ‘¸äº‹ä»¶çš„åŠŸèƒ½ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">public boolean onTouchEvent(CoordinatorLayout parent, V child, MotionEvent ev) &#123;</span><br><span class="line">       ...</span><br><span class="line">        switch (ev.getActionMasked()) &#123;</span><br><span class="line">            ...</span><br><span class="line">            case MotionEvent.ACTION_MOVE: &#123;</span><br><span class="line">                final int activePointerIndex = ev.findPointerIndex(mActivePointerId);</span><br><span class="line">                if (activePointerIndex == -1) &#123;</span><br><span class="line">                    return false;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                final int y = (int) ev.getY(activePointerIndex);</span><br><span class="line">                int dy = mLastMotionY - y;</span><br><span class="line"></span><br><span class="line">                if (!mIsBeingDragged &amp;&amp; Math.abs(dy) &gt; mTouchSlop) &#123;</span><br><span class="line">                    mIsBeingDragged = true;</span><br><span class="line">                    if (dy &gt; 0) &#123;</span><br><span class="line">                        dy -= mTouchSlop;</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        dy += mTouchSlop;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                if (mIsBeingDragged) &#123;</span><br><span class="line">                    mLastMotionY = y;</span><br><span class="line">                    // We&apos;re being dragged so scroll the ABL</span><br><span class="line">                    scroll(parent, child, dy, getMaxDragOffset(child), 0);</span><br><span class="line">                &#125;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            case MotionEvent.ACTION_UP:</span><br><span class="line">                if (mVelocityTracker != null) &#123;</span><br><span class="line">                    mVelocityTracker.addMovement(ev);</span><br><span class="line">                    mVelocityTracker.computeCurrentVelocity(1000);</span><br><span class="line">                    float yvel = mVelocityTracker.getYVelocity(mActivePointerId);</span><br><span class="line">                    fling(parent, child, -getScrollRangeForDragFling(child), 0, yvel);</span><br><span class="line">                &#125;</span><br><span class="line">         ...</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ¥çœ‹onTouchEventçš„æ–¹æ³•ï¼Œä¸»è¦é€»è¾‘è¿˜æ˜¯åœ¨ACTION_MOVEä¸­ï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ»‘åŠ¨è¿‡ç¨‹ä¸­è°ƒç”¨äº†scroll(â€¦)æ–¹æ³•ï¼Œscroll(â€¦)æ–¹æ³•åœ¨HeaderBehaviorä¸­è¿›è¡Œå®ç°ï¼Œæœ€ç»ˆè°ƒç”¨åˆ°äº†é¢setHeaderTopBottomOffset(â€¦)æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨AppBarLayout.Behaviorä¸­è¿›è¡Œäº†é‡å†™ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹AppBarLayout.Behaviorä¸­çš„æºç å³å¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">   //newOffesetä¼ å…¥äº†dyï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰‹æŒ‡ç§»åŠ¨è·ç¦»ä¸Šä¸€æ¬¡ç§»åŠ¨çš„è·ç¦»ï¼Œ</span><br><span class="line">   //minOffsetç­‰äºAppBarLayoutçš„è´Ÿçš„heightï¼ŒmaxOffsetç­‰äº0ã€‚</span><br><span class="line">        int setHeaderTopBottomOffset(CoordinatorLayout coordinatorLayout,</span><br><span class="line">                AppBarLayout appBarLayout, int newOffset, int minOffset, int maxOffset) &#123;</span><br><span class="line">            final int curOffset = getTopBottomOffsetForScrollingSibling();//è·å–å½“å‰çš„æ»‘åŠ¨Offset</span><br><span class="line">            int consumed = 0;</span><br><span class="line">			//AppBarLayoutæ»‘åŠ¨çš„è·ç¦»å¦‚æœè¶…å‡ºäº†minOffsetæˆ–è€…maxOffsetï¼Œåˆ™ç›´æ¥è¿”å›0</span><br><span class="line">            if (minOffset != 0 &amp;&amp; curOffset &gt;= minOffset &amp;&amp; curOffset &lt;= maxOffset) &#123;</span><br><span class="line">               //çŸ«æ­£newOffsetï¼Œä½¿å…¶minOffset&lt;=newOffset&lt;=maxOffset</span><br><span class="line">                newOffset = MathUtils.clamp(newOffset, minOffset, maxOffset);</span><br><span class="line">				//ç”±äºé»˜è®¤æ²¡è®¾ç½®Interpolatorï¼Œæ‰€ä»¥interpolatedOffset=newOffset;</span><br><span class="line">                if (curOffset != newOffset) &#123;</span><br><span class="line">                    final int interpolatedOffset = appBarLayout.hasChildWithInterpolator()</span><br><span class="line">                            ? interpolateOffset(appBarLayout, newOffset)</span><br><span class="line">                            : newOffset;</span><br><span class="line">					//è°ƒç”¨ViewOffsetBehvaiorçš„æ–¹æ³•setTopAndBottomOffset(...)ï¼Œæœ€ç»ˆé€šè¿‡</span><br><span class="line">					//ViewCompat.offsetTopAndBottom()ç§»åŠ¨AppBarLayout</span><br><span class="line">                    final boolean offsetChanged = setTopAndBottomOffset(interpolatedOffset);</span><br><span class="line"></span><br><span class="line">                    //è®°å½•ä¸‹æ¶ˆè´¹äº†å¤šå°‘çš„dyã€‚</span><br><span class="line">                    consumed = curOffset - newOffset;</span><br><span class="line">                   //æ²¡è®¾ç½®Interpolatorçš„æƒ…å†µï¼Œ mOffsetDeltaæ°¸è¿œ=0</span><br><span class="line">                    mOffsetDelta = newOffset - interpolatedOffset;</span><br><span class="line">					....</span><br><span class="line">                     //åˆ†å‘å›è°ƒOnOffsetChangedListener.onOffsetChanged(...)</span><br><span class="line">                    appBarLayout.dispatchOffsetUpdates(getTopAndBottomOffset());</span><br><span class="line"></span><br><span class="line">                  </span><br><span class="line">                    updateAppBarLayoutDrawableState(coordinatorLayout, appBarLayout, newOffset,</span><br><span class="line">                            newOffset &lt; curOffset ? -1 : 1, false);</span><br><span class="line">                &#125;</span><br><span class="line">           ...</span><br><span class="line">            return consumed;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>AppBarLayoutä¸­ç§»åŠ¨ä¸»è¦å°±æ˜¯è¿™éƒ¨åˆ†é€»è¾‘äº†ï¼Œé€šè¿‡setTopAndBottomOffset()æ¥è¾¾åˆ°äº†ç§»åŠ¨æˆ‘ä»¬çš„AppBarLayoutï¼Œé‚£ä¹ˆè¿™é‡ŒAppBarLayoutå°±å¯ä»¥è·Ÿç€æ‰‹ä¸Šä¸‹ç§»åŠ¨äº†ã€‚</p>
<h4 id="RecycleViewä¸­çš„Behavior"><a href="#RecycleViewä¸­çš„Behavior" class="headerlink" title="RecycleViewä¸­çš„Behavior"></a>RecycleViewä¸­çš„Behavior</h4><p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹RecycleViewåœ¨CoordinatorLayoutä¸­å¦‚ä½•æ˜¯ç§»åŠ¨çš„ï¼Ÿ</p>
<p>ä¸Šé¢è®²äº†AppBarLayoutæ˜¯å¦‚ä½•é€šè¿‡Behavioræ¥ç§»åŠ¨çš„ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢å¸ƒå±€æ–‡ä»¶ä¸­æŒ‡å®šäº†ViewPagerçš„Behaviorã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app:layout_behavior=&quot;@string/appbar_scrolling_view_behavior&quot;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªâ€appbar_scrolling_view_behaviorâ€å…¶å®å°±æ˜¯ScrollingViewBehaviorï¼ŒScrollingViewBehaviorä¹Ÿç»§æ‰¿è‡ªViewOffsetBehaviorï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸‹ç§»åŠ¨AppBarLayoutçš„æ—¶å€™ï¼Œä¸‹é¢çš„RecycleViewä¹Ÿæ˜¯éœ€è¦è·Ÿç€ç§»åŠ¨çš„ï¼Œå®ƒä¸Šä¸‹ç§»åŠ¨å°±æ˜¯é è¿™ä¸ªæ¥ScrollingViewBehavioræ¥å®ç°çš„ã€‚</p>
<p>åœ¨é˜…è¯»ScrollingViewBehavioræºç ä¸­å‘ç°å…¶å®ç°äº†å¦‚ä¸‹æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean layoutDependsOn(CoordinatorLayout parent, View child, View dependency) &#123;</span><br><span class="line">    // We depend on any AppBarLayouts</span><br><span class="line">    return dependency instanceof AppBarLayout;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public boolean onDependentViewChanged(CoordinatorLayout parent, View child,</span><br><span class="line">        View dependency) &#123;</span><br><span class="line">    offsetChildAsNeeded(parent, child, dependency);</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·æˆ‘ä»¬è¿™ä¸ªRecycleViewä¾èµ–äºAppBarLayoutï¼Œåœ¨AppBarLayoutç§»åŠ¨çš„è¿‡ç¨‹ä¸­ï¼ŒRecycleViewä¼šéšç€AppBarLayoutçš„ç§»åŠ¨å›è°ƒonDependentViewChanged(â€¦)æ–¹æ³•ï¼Œè¿›è€Œè°ƒç”¨offsetChildAsNeeded(parent, child, dependency)ã€‚</p>
<p>ç”¨è¿™ä¹ˆå¤šç¯‡å¹…ä¸»è¦è®²äº†CoordinatorLayoutå¦‚ä½•åè°ƒAppBarLayoutå’ŒRecycleViewæ¥ä¸Šä¸‹æ»šåŠ¨çš„ï¼Œæ¥ç€å›åˆ°åˆšå¼€å§‹æˆ‘ä»¬è¦è®¨è®ºé‚£ä¸ªåŠ¨ç”»æŠ–åŠ¨é—®é¢˜ã€‚</p>
<p>å…¶å®é€ æˆè¿™ä¸ªçš„åŸå› ä¸»è¦æ˜¯AppBarLayoutçš„flingæ“ä½œå’ŒRecycleViewè”åŠ¨é€ æˆçš„é—®é¢˜ã€‚</p>
<p>åœ¨AppBarLayoutçš„Behaviorä¸­çš„onTouchEvent()äº‹ä»¶ä¸­å¤„ç†äº†flingäº‹ä»¶ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public boolean onTouchEvent(CoordinatorLayout parent, V child, MotionEvent ev) &#123;</span><br><span class="line">    ...</span><br><span class="line">    case MotionEvent.ACTION_UP:</span><br><span class="line">        if (mVelocityTracker != null) &#123;</span><br><span class="line">            mVelocityTracker.addMovement(ev);</span><br><span class="line">            mVelocityTracker.computeCurrentVelocity(1000);</span><br><span class="line">            float yvel = mVelocityTracker.getYVelocity(mActivePointerId);</span><br><span class="line">            fling(parent, child, -getScrollRangeForDragFling(child), 0, yvel);</span><br><span class="line">        &#125;</span><br><span class="line">    ...</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>åœ¨flingçš„æ–¹æ³•ä¸­ä½¿ç”¨OverScrolleræ¥æ¨¡æ‹Ÿè¿›è¡Œflingæ“ä½œï¼Œæœ€ç»ˆä¼šè°ƒåˆ°setHeaderTopBottomOffset(â€¦)æ¥ä½¿AppBarLayoutè¿›è¡Œflingçš„æ»‘åŠ¨æ“ä½œã€‚</p>
<p>åœ¨ç»å¤§éƒ¨åˆ†æ»‘åŠ¨é€»è¾‘ä¸­ï¼Œè¿™æ ·å¤„ç†æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯å¦‚æœåœ¨AppBarLayoutåœ¨flingçš„æ—¶å€™ä¸»åŠ¨æ»‘åŠ¨RecyclerViewï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆåŠ¨ç”»æŠ–åŠ¨çš„é—®é¢˜äº†ã€‚</p>
<p>åœ¨å½“å‰æƒ…å†µä¸‹ï¼ŒRecyclerViewæ»‘åŠ¨åˆ°å¤´äº†ï¼Œé‚£ä¹ˆå°±ä¼šæŠŠæœªæ¶ˆè´¹çš„äº‹ä»¶é€šè¿‡NestedScrollingChild2äº¤ä»˜ç”±CoordinatorLayout(å®ç°äº†NestedScrollingParent2)å¤„ç†ï¼Œparentåˆæœ€ç»ˆäº¤ä»˜ç”±AppBarLayout.Behaviorè¿›è¡Œå¤„ç†çš„ï¼Œå…¶ä¸­è°ƒç”¨çš„æ–¹æ³•å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void onNestedScroll(CoordinatorLayout coordinatorLayout, AppBarLayout child,</span><br><span class="line">        View target, int dxConsumed, int dyConsumed, int dxUnconsumed, int dyUnconsumed,</span><br><span class="line">        int type) &#123;</span><br><span class="line">    if (dyUnconsumed &lt; 0) &#123;</span><br><span class="line">        // If the scrolling view is scrolling down but not consuming, it&apos;s probably be at</span><br><span class="line">        // the top of it&apos;s content</span><br><span class="line">        scroll(coordinatorLayout, child, dyUnconsumed,</span><br><span class="line">                -child.getDownNestedScrollRange(), 0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œçš„scrollæ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨setHeaderTopBottomOffset(â€¦)ï¼Œç”±äºä¸¤æ¬¡åˆ†åˆ«è§¦æ‘¸åœ¨AppBarLayoutå’ŒRecyclerViewçš„æ–¹å‘ä¸ä¸€è‡´ï¼Œå¯¼è‡´äº†æœ€ç»ˆçš„æŠ–åŠ¨çš„æ•ˆæœã€‚</p>
<p>è§£å†³æ–¹å¼ä¹Ÿå¾ˆç®€å•,åªè¦åœ¨CoordinatorLayoutçš„onInterceptedTouchEvent()ä¸­åœæ­¢AppBarLayoutçš„flingæ“ä½œå°±å¯ä»¥äº†ï¼Œç›´æ¥æ“ä½œçš„å¯¹è±¡å°±æ˜¯AppBarLayoutä¸­çš„Behaviorï¼Œè¯¥Behaviorç»§æ‰¿è‡ªHeaderBehaviorï¼Œè€Œflingæ“ä½œç”±OverScrolleräº§ç”Ÿï¼Œæ‰€ä»¥è‡ªå®šä¹‰ä¸€ä¸ªFixedBehaviorï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">public class FixedBehavior extends AppBarLayout.Behavior &#123;</span><br><span class="line">    private OverScroller mOverScroller;</span><br><span class="line"></span><br><span class="line">    public FixedBehavior() &#123;</span><br><span class="line">        super();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public FixedBehavior(Context context, AttributeSet attrs) &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onAttachedToLayoutParams(@NonNull CoordinatorLayout.LayoutParams params) &#123;</span><br><span class="line">        super.onAttachedToLayoutParams(params);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onDetachedFromLayoutParams() &#123;</span><br><span class="line">        super.onDetachedFromLayoutParams();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onTouchEvent(CoordinatorLayout parent, AppBarLayout child, MotionEvent ev) &#123;</span><br><span class="line">        if (ev.getAction() == MotionEvent.ACTION_UP) &#123;</span><br><span class="line">            reflectOverScroller();</span><br><span class="line">        &#125;</span><br><span class="line">        return super.onTouchEvent(parent, child, ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     */</span><br><span class="line">    public void stopFling() &#123;</span><br><span class="line">        if (mOverScroller != null) &#123;</span><br><span class="line">            mOverScroller.abortAnimation();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * è§£å†³AppbarLayoutåœ¨flingçš„æ—¶å€™ï¼Œå†ä¸»åŠ¨æ»‘åŠ¨RecyclerViewå¯¼è‡´çš„åŠ¨ç”»é”™è¯¯çš„é—®é¢˜</span><br><span class="line">     */</span><br><span class="line">    private void reflectOverScroller() &#123;</span><br><span class="line">        if (mOverScroller == null) &#123;</span><br><span class="line">            Field field = null;</span><br><span class="line">            try &#123;</span><br><span class="line">                field = getClass().getSuperclass()</span><br><span class="line">                        .getSuperclass().getDeclaredField(&quot;mScroller&quot;);</span><br><span class="line">                field.setAccessible(true);</span><br><span class="line">                Object object = field.get(this);</span><br><span class="line">                mOverScroller = (OverScroller) object;</span><br><span class="line">            &#125; catch (NoSuchFieldException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; catch (IllegalAccessException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ç„¶ååœ¨é‡å†™CoordinatorLayoutï¼Œæš´éœ²ä¸€ä¸ªæ¥å£ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public class CustomCoordinatorLayout extends CoordinatorLayout &#123;</span><br><span class="line">    private OnInterceptTouchListener mListener;</span><br><span class="line"></span><br><span class="line">    public void setOnInterceptTouchListener(OnInterceptTouchListener listener) &#123;</span><br><span class="line">        mListener = listener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CustomCoordinatorLayout(Context context) &#123;</span><br><span class="line">        super(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CustomCoordinatorLayout(Context context, AttributeSet attrs) &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public CustomCoordinatorLayout(Context context, AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean onInterceptTouchEvent(MotionEvent ev) &#123;</span><br><span class="line">        if (mListener != null) &#123;</span><br><span class="line">            mListener.onIntercept();</span><br><span class="line">        &#125;</span><br><span class="line">        return super.onInterceptTouchEvent(ev);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public interface OnInterceptTouchListener &#123;</span><br><span class="line">        void onIntercept();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ¥ç€åœ¨æ¥å£ä¸­å¤„ç†æ»‘åŠ¨é—®é¢˜å³å¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">coordinatorLayout.setOnInterceptTouchListener &#123;</span><br><span class="line">    //RecyclerViewæ»‘åŠ¨çš„æ—¶å€™ç¦æ­¢AppBarLayoutçš„æ»‘åŠ¨</span><br><span class="line">    if (customBehavior != null) &#123;</span><br><span class="line">        customBehavior!!.stopFling()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="ç¬¬äºŒï¼Œå›å¼¹é—®é¢˜"><a href="#ç¬¬äºŒï¼Œå›å¼¹é—®é¢˜" class="headerlink" title="ç¬¬äºŒï¼Œå›å¼¹é—®é¢˜"></a>ç¬¬äºŒï¼Œå›å¼¹é—®é¢˜</h4><p>é—®é¢˜åœºæ™¯æè¿°ï¼Œæˆ‘ä»¬åå¤ä¸Šä¸‹æ»‘åŠ¨AppBarLayoutçš„æ—¶å€™ï¼Œå¯ä»¥çœ‹åˆ°AppBarLayoutåœ¨æ»‘å‡ºå±å¹•å¤–ä¹‹ååˆåå¼¹å›å»äº†ï¼Œè€Œä¸”å½“ä½ æ»‘åŠ¨çš„åŠ é€Ÿåº¦å¾ˆå¤§çš„æ—¶å€™ï¼Œè¿™ä¸ªåå¼¹çš„å¹…åº¦ä¹Ÿä¼šè·Ÿç€å˜å¤§ã€‚</p>
<p><img src="https://raw.githubusercontent.com/JasonGaoH/Images/master/coordinator_resize_2.gif" alt="image"></p>
<p>è¿™ä¸ªé—®é¢˜é€ æˆçš„åŸå› æ˜¯å› ä¸ºåœ¨æ‰‹æŒ‡å‘ä¸Šæ»‘åŠ¨åé€ æˆRecyclerViewçš„flingæ“ä½œæ‰§è¡Œï¼Œå…·ä½“çš„ä»£ç åœ¨RecyclerViewå†…éƒ¨ç±»ViewFlingerä¸­ã€‚</p>
<p>æˆ‘ä½¿ç”¨Android Studioä¸­çš„ProfileræŠ“å–äº†ä¸€ä¸‹å½“å‡ºç°åå¼¹é—®é¢˜çš„æ—¶å€™å‡ºç°çš„æ–¹æ³•è°ƒç”¨å †æ ˆå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://raw.githubusercontent.com/JasonGaoH/Images/master/coordinator_bugs_method_call.jpg" alt="image"></p>
<p>å‘ç°RecyclerViewä¸­ViewFlingerè°ƒç”¨åï¼Œæ¥ç€è§¦å‘äº†HeaderBehaviorä¸­çš„FlingRunnableã€‚è€ŒViewFlingä¸­ä¼šè°ƒç”¨dispatchNestedScroll(â€¦)æ–¹æ³•ï¼ŒRecyclerViewä½œä¸ºCoordinatorLayoutçš„å­Viewï¼Œå®ƒé€šè¿‡åµŒå¥—æ»šåŠ¨çš„æœºåˆ¶åˆä¼šè°ƒç”¨åˆ°CoordinatorLayoutä¸­çš„onNestedScrollï¼Œè¿™é‡Œä¸»è¦å°±æ˜¯é€šè¿‡AppBarLayoutçš„Behaviorä¸­çš„æ–¹æ³•setHeaderTopBottomOffsetæ¥å®ç°AppBarLayoutçš„æ»šåŠ¨ï¼Œåé¢ä¼šå‘ç°å¤šæ¬¡setHeaderTopBottomOffsetçš„è°ƒç”¨ï¼Œå…¶å®ç›®å‰çœ‹åˆ°è¿™é‡Œï¼Œå¹¶ä¸å¤ªç¡®å®šé€ æˆè¿™ä¸ªé—®é¢˜çš„å…·ä½“åŸå› æ˜¯å•¥ï¼Œæ„Ÿè§‰ä¸Šæ˜¯å› ä¸ºRecyclerViewçš„æ»‘åŠ¨å’ŒCoordinatorLayoutçš„æ»‘åŠ¨å†²çªå¯¼è‡´äº†åå¼¹æ•ˆæœçš„å‡ºç°ã€‚</p>
<p>äºæ˜¯å°è¯•äº†ä¸‹é¢çš„è§£å†³æ–¹æ³•ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">coordinatorLayout.setOnInterceptTouchListener &#123;</span><br><span class="line">    mRecyclerView.stopScroll()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¯•äº†è¿™ä¸ªæ–¹æ³•å‘ç°æœç„¶æœ‰æ•ˆã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘åœ¨å†™demoçš„æ—¶å€™å‘ç°ï¼Œè¿™ä¸ªé—®é¢˜åœ¨support-27æ˜¯å­˜åœ¨çš„ï¼Œåœ¨support-28 Googleå·²ç»ä¿®å¤è¿‡äº†ã€‚</p>
<p>æˆ‘å°è¯•è¿‡çœ‹çœ‹support-28é‡Œé¢çš„éƒ½æœ‰å“ªäº›æ”¹åŠ¨ï¼Œæƒ³çœ‹çœ‹Googleæ˜¯å¦‚ä½•ä¿®å¤çš„ã€‚çœ‹äº†ä¸‹Googleçš„release noteå¹¶æ²¡æœ‰æåŠï¼Œå¦‚æœä»Googleçš„commit historyæ¥çœ‹å®åœ¨é¡µçœ‹ä¸å‡ºæ¥å•¥ï¼Œæš‚æ—¶ä¹Ÿæ²¡æœ‰ä¸ªå…·ä½“çš„åŸå› ã€‚</p>
<p>åé¢å¯ä»¥å°†support-27å’Œsupport-28çš„sourceä¸‹è½½ä¸‹æ¥ï¼Œç„¶åä½¿ç”¨Beyond Compareæ¥çœ‹çœ‹å…·ä½“çš„diffæ”¹åŠ¨æ˜¯åœ¨å“ªã€‚</p>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#UI">
    <span class="tag-code">UI</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2020/05/21/ä»æºç è§’åº¦å‰–æHandleræœºåˆ¶/">
        <span class="nav-arrow">â† </span>
        
          ä»æºç è§’åº¦å‰–æHandleræœºåˆ¶
        
      </a>
    
    
      <a class="nav-right" href="/2020/05/21/ä»¿äº¬ä¸œã€æ·˜å®é¦–é¡µï¼Œé€šè¿‡ä¸¤å±‚åµŒå¥—çš„RecyclerViewå®ç°tabçš„å¸é¡¶æ•ˆæœ/">
        
          ä»¿äº¬ä¸œã€æ·˜å®é¦–é¡µï¼Œé€šè¿‡ä¸¤å±‚åµŒå¥—çš„RecyclerViewå®ç°tabçš„å¸é¡¶æ•ˆæœ
        
        <span class="nav-arrow"> â†’</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- æ‰“èµ START -->
    
    <!-- æ‰“èµ END -->
    <!-- äºŒç»´ç  START -->
    
      <div class="qrcode"></div>
      <p class="notice">å…¬ä¼—å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ˜„</p>
    
    <!-- äºŒç»´ç  END -->
    
      <!-- Utterances START -->
      <div id="utterances"></div>
      <script src="https://utteranc.es/client.js" repo="JasonGaoH/RepoForUtterances" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>    
      <!-- Utterances END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
  <!-- Catalog END -->

</main>

<script>
  (function () {
    var url = 'JasonGaoH.github.io/2020/05/21/è§£å†³CoordinatorLayoutçš„åŠ¨ç”»æŠ–åŠ¨ä»¥åŠå›å¼¹é—®é¢˜/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', '/css/images/error_icon.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== '/css/images/error_icon.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>







    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2023 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    
    

    <br>
    æœ¬ç«™ç´¯è®¡è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>,
    æœ¬ç«™ç´¯è®¡è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>
  </p>
</footer>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      hljs.configure({useBR: true});
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>

  </body>
</html>