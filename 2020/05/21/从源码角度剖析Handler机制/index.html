<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="åšæŒè¾“å‡ºï¼ŒåšæŒä¹¦å†™ï¼Œæ‰å¯ä»¥æŒç»­æˆé•¿">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      ä»æºç è§’åº¦å‰–æHandleræœºåˆ¶ | JasonGao Thoughts
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    <script src="/js/qrious.js"></script>
  
  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


  
  
    <script src="/js/local-search.js"></script>

<link rel="alternate" href="atom.xml" title="JasonGao Thoughts" type="application/atom+xml">
</head>
<div class="wechat-share">
  <img src="/css/images/logo.png">
</div>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>JasonGao Thoughts</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
      
        <li class="menu-item menu-item-search right-list">
    <a role="button" class="popup-trigger">
        <i class="fa fa-search fa-fw"></i>
    </a>
</li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
    
      <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
            <span class="search-icon">
                <i class="fa fa-search"></i>
            </span>
            <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="Please enter your keyword(s) to search." spellcheck="false" type="search" class="search-input">
            </div>
            <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>
    
  </div>
</header>

    <div id="article-banner">
  <h2>ä»æºç è§’åº¦å‰–æHandleræœºåˆ¶</h2>
  <p class="post-date">2020-05-21</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><p>androidä¸­ï¼Œåœ¨è¿›è¡Œè€—æ—¶æ“ä½œæ›´æ–°UIç”¨åˆ°æœ€å¤šçš„æ–¹æ³•å°±æ˜¯Handleräº†ï¼Œä¸€èˆ¬åœ¨å­çº¿ç¨‹ä¸­è¿›è¡Œè€—æ—¶æ“ä½œï¼ˆè®¿é—®ç½‘ç»œç­‰ï¼‰ï¼Œç„¶åå‘é€æ¶ˆæ¯åˆ°UIçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ï¼Œä½¿å¾—ç•Œé¢å¾—ä»¥æ›´æ–°ã€‚</p>
<p>å¯¹äºHandlerçš„ç”¨æ³•ï¼Œç›¸ä¿¡å¤§å®¶éƒ½æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œé‚£ä¹ˆHandleræœºåˆ¶çš„åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬ä»Šå¤©ä»æºç è§’åº¦æ¥åˆ†æä¸‹Handleræœºåˆ¶çš„åŸç†ã€‚<br><a id="more"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Handler mHandler = <span class="keyword">new</span> Handler()&#123;  </span><br><span class="line">          </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;  </span><br><span class="line">            <span class="comment">//å¤„ç†æ¶ˆæ¯</span></span><br><span class="line">        &#125;;  </span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆçœ‹ä¸¤å¼ å…³äºHandlerçš„å›¾ï¼š<br>å¸Œæœ›èƒ½å¸®åŠ©å¤§å®¶ç†è§£ã€‚</p>
<p>ç¬¬ä¸€å¼ ä¹¦åºå›¾æ¥è‡ªç½‘ç»œï¼Œç¬¬äºŒå¼ ç±»æ˜¯è°ƒç”¨å…³ç³»å›¾ã€‚<br><img src="https://raw.githubusercontent.com/JasonGaoH/Images/master/handler_1.png" alt="image"></p>
<p><img src="https://raw.githubusercontent.com/JasonGaoH/Images/master/handler_3.png" alt="image"></p>
<pre><code>    A Handler allows you to send and process Message and Runnable
objects associated with a thread&apos;s MessageQueue.  Each Handler
instance is associated with a single thread and that thread&apos;s message
queue.  When you create a new Handler, it is bound to the thread /
message queue of the thread that is creating it -- from that point on,
it will deliver messages and runnables to that message queue and execute
them as they come out of the message queue.

There are two main uses for a Handler: (1) to schedule messages and
runnables to be executed as some point in the future; and (2) to enqueue
an action to be performed on a different thread than your own.
</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹APIä¸­ç»™çš„æè¿°ï¼Œä¸€ä¸ªHandlerèƒ½å¤Ÿé€šè¿‡å…³è”çš„çº¿ç¨‹çš„MessageQueueæ¥å‘é€å’Œå¤„ç†Message    å’ŒRunnableå¯¹è±¡ã€‚æ¯ä¸€ä¸ªHandlerå®ä¾‹åŒ–çš„æ—¶å€™ä¼šå…³è”ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹å’Œè¿™ä¸ªçº¿ç¨‹çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚å½“    ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„Handlerï¼Œå®ƒä¼šç»‘å®šåˆ°åˆ›å»ºå®ƒçš„çš„çº¿ç¨‹å’Œæ¶ˆæ¯é˜Ÿåˆ—ä¸Šâ€“ä»è¿™ä¸ªç‚¹ä¸Šï¼Œå½“æ¶ˆæ¯é˜Ÿåˆ—ä¸­    æœ‰æ¶ˆæ¯æ¥çš„æ—¶å€™ï¼Œå®ƒä¼šä¼ é€’æ¶ˆæ¯å’ŒRunnableå¯¹è±¡åˆ°é‚£ä¸ªæ¶ˆæ¯é˜Ÿåˆ—å¹¶ä¸”ä¼šæ‰§è¡Œè¿™äº›æ¶ˆæ¯ã€‚</p>
<p>Handleræœ‰ä¸¤ä¸ªç”¨æ³•ï¼šï¼ˆ1ï¼‰èƒ½å¤Ÿä½¿messageså’Œrunnablesåœ¨å³å°†åˆ°æ¥çš„æŸä¸ªç‚¹ä¸€åŒæ‰§è¡Œï¼›ï¼ˆ2ï¼‰èƒ½å¤Ÿåè°ƒä¸€ä¸ªæ“ä½œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸­çš„æ‰§è¡Œ</p>
<blockquote>
<h4 id="Handler-çš„æ„é€ æ–¹æ³•"><a href="#Handler-çš„æ„é€ æ–¹æ³•" class="headerlink" title="Handler çš„æ„é€ æ–¹æ³•"></a>Handler çš„æ„é€ æ–¹æ³•</h4><p>æˆ‘ä»¬ä»Handleråˆå§‹åŒ–å¼€å§‹ï¼Œä»æ„é€ æ–¹æ³•å…¥å£ï¼Œçœ‹çœ‹å®ƒå®ä¾‹åŒ–çš„æ—¶å€™åšäº†ä»€ä¹ˆæ“ä½œã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>(<span class="keyword">null</span>, <span class="keyword">false</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>é»˜è®¤çš„æ„é€ æ–¹æ³•ä¼šè°ƒç”¨ä¸‹é¢è¿™ä¸ªå¸¦ä¸¤ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Handler</span><span class="params">(Callback callback, <span class="keyword">boolean</span> async)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (FIND_POTENTIAL_LEAKS) &#123;</span><br><span class="line">           <span class="keyword">final</span> Class&lt;? extends Handler&gt; klass = getClass();</span><br><span class="line">           <span class="keyword">if</span> ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;</span><br><span class="line">                   (klass.getModifiers() &amp; Modifier.STATIC) == <span class="number">0</span>) &#123;</span><br><span class="line">               Log.w(TAG, <span class="string">"The following Handler class should be static or leaks might occur: "</span> +</span><br><span class="line">                   klass.getCanonicalName());</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">////////////////////////////////</span></span><br><span class="line">       è·å–Looper</span><br><span class="line">       mLooper = Looper.myLooper();</span><br><span class="line">       <span class="comment">///////////////////////////////</span></span><br><span class="line">       <span class="keyword">if</span> (mLooper == <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">               <span class="string">"Can't create handler inside thread that has not called Looper.prepare()"</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       mQueue = mLooper.mQueue;</span><br><span class="line">       mCallback = callback;</span><br><span class="line">       mAsynchronous = async;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬è¿™é‡Œä¸»è¦çœ‹<strong><em>mLooper = Looper.myLooper();</em></strong> è¿™è¡Œä»£ç ï¼ŒLooperæ˜¯ä»€ä¹ˆå‘¢ï¼Œæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬è¿½è¸ªåˆ°Looperçš„myLooperæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Looper <span class="title">myLooper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> sThreadLocal.get();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>é—®é¢˜åˆæ¥äº†ï¼Œè¿™ä¸ªThreadLoacalåˆæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ</p>
<p>ThreadLoacalå³çº¿ç¨‹å±€éƒ¨å˜é‡ï¼ŒThreadLocalè®¾è®¡å‡ºæ¥æ˜¯ä¸ºäº†é¿å…åœ¨çº¿ç¨‹é—´å…±äº«å˜é‡ï¼Œä½¿ç”¨ThreadLoacalèƒ½å¤Ÿä¸ºå„ä¸ªçº¿ç¨‹æä¾›å„è‡ªçš„å®ä¾‹ã€‚<br>ThreadLocalçš„ä¸¤ä¸ªæ–¹æ³•ï¼š<br>getå’Œsetç”¨äºè·å–ThreadLocalä¸­å­˜å‚¨çš„å±€éƒ¨å˜é‡<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  Returns the value in the current thread's copy of this thread-local variable.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span>ï¼›</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">/**</span></span></span><br><span class="line"><span class="function"><span class="comment">  Sets the current thread's copy of this thread-local variable to the specified value.</span></span></span><br><span class="line"><span class="function"><span class="comment">*/</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(T value)</span></span></span><br></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæˆ‘ä»¬åªåšç®€å•çš„ä»‹ç»ï¼Œå…³äºThreadLoacalè¿™é‡Œä¸åšè¯¦ç»†ä»‹ç»ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªå·±ç ”ç©¶ç ”ç©¶ã€‚</p>
<p>æˆ‘ä»¬çœ‹ä¸‹é¢çš„ä»£ç ç‰‡æ®µï¼ŒThreadLocalä½œä¸ºLooperçš„é™æ€å¸¸é‡ï¼Œä¸€èˆ¬åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±ä¼šåˆ›å»ºï¼ˆé™æ€æˆå‘˜å˜é‡å’Œé™æ€åˆå§‹åŒ–å—çº§åˆ«ç›¸åŒï¼‰ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹è¿™ä¸ªprepareæ–¹æ³•ï¼Œprepareæ–¹æ³•ä¸­ä¼šå°†Looperæ”¾åœ¨ThreadLocalï¼Œç¡®ä¿æ¯ä¸ªçº¿ç¨‹å–å¾—Looperçš„æ—¶å€™æ˜¯å±äºè‡ªå·±çš„é‚£ä¸ªLooperã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//sThreadLocalçš„åˆ›å»º</span></span><br><span class="line"> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Looper&gt; sThreadLocal = <span class="keyword">new</span> ThreadLocal&lt;Looper&gt;();</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">(<span class="keyword">boolean</span> quitAllowed)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (sThreadLocal.get() != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Only one Looper may be created per thread"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//åˆ›å»ºLooperå¹¶å°†Looperä¿å­˜åˆ°sThreadLocalä¸­</span></span><br><span class="line">    sThreadLocal.set(<span class="keyword">new</span> Looper(quitAllowed));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>çœ‹åˆ°è¿™é‡Œï¼Œç»†å¿ƒçš„ä½ ä¸ç”±å¾—ä¼šäº§ç”Ÿè¿™æ ·çš„ç–‘é—®ï¼ŒLooperåœ¨è°ƒç”¨myLooperæ–¹æ³•è·å¾—ThreadLocalä¸­å­˜æ”¾çš„Looperçš„æ—¶å€™ï¼Œå¦‚æœprepareæ–¹æ³•æ²¡æœ‰åœ¨è¿™ä¹‹å‰è°ƒç”¨çš„è¯ï¼Œé‚£ä¹ˆè‚¯å®šæ˜¯å–ä¸åˆ°Looperçš„ï¼Œä½†é—®é¢˜æ˜¯å¹³æ—¶æˆ‘ä»¬åœ¨ä½¿ç”¨Handlerçš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰è°ƒç”¨Looperä¸­çš„prepareæ–¹æ³•å•Šï¼Ÿ</p>
<p>å…¶å®æˆ‘ä»¬å¹³æ—¶ç”¨Handlerçš„æ—¶å€™ï¼Œéƒ½æ˜¯åœ¨Mainçº¿ç¨‹ä¸­ï¼Œåœ¨Mainçº¿ç¨‹ä¸­ï¼Œå·²ç»æå‰è°ƒç”¨è¿‡è¿™ä¸ªprepareæ–¹æ³•äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ...............</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//////////////////////////////</span></span><br><span class="line">        â‘ ä¸»çº¿ç¨‹è°ƒç”¨prepareæ–¹æ³•ï¼Œåˆ›å»ºLooper</span><br><span class="line">        Looper.prepareMainLooper();</span><br><span class="line">        <span class="comment">/////////////////////////////</span></span><br><span class="line"></span><br><span class="line">        ActivityThread thread = <span class="keyword">new</span> ActivityThread();</span><br><span class="line">        thread.attach(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (sMainThreadHandler == <span class="keyword">null</span>) &#123;</span><br><span class="line">            sMainThreadHandler = thread.getHandler();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        AsyncTask.init();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">false</span>) &#123;</span><br><span class="line">            Looper.myLooper().setMessageLogging(<span class="keyword">new</span></span><br><span class="line">                    LogPrinter(Log.DEBUG, <span class="string">"ActivityThread"</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//////////////////////////////</span></span><br><span class="line">        â‘¡è°ƒç”¨loopè¿›è¡Œæ¶ˆæ¯å¾ªç¯</span><br><span class="line">        Looper.loop();</span><br><span class="line">        <span class="comment">//////////////////////////////</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Main thread loop unexpectedly exited"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ActivityThreadçš„mainæ–¹æ³•ä¸­ï¼Œâ‘ è¿™é‡Œä¼šè°ƒç”¨æ¥prepareMainLooperåˆ›å»ºLooperï¼ŒprepareMainLooperä¼šè½¬æ‰Looperä¸­çš„prepareæ–¹æ³•ã€‚ActivityThreadçš„mainæ–¹æ³•å…¶å®æ˜¯androidä¸€ä¸ªåº”ç”¨ç¨‹åºçš„å…¥å£ï¼Œæ¯å¯åŠ¨ä¸€ä¸ªåº”ç”¨è¿›ç¨‹ï¼Œéƒ½ä¼šåˆ›å»ºActivityThreadä¸ä¹‹å¯¹åº”çš„å®ä¾‹ï¼Œæ˜¯åº”ç”¨ç¨‹åºçš„UIçº¿ç¨‹ã€‚UIçº¿ç¨‹ä¸­ä¼šé€šè¿‡prepareMainLooperç­‰æ–¹æ³•æ¥å»ºç«‹æ¶ˆæ¯å¾ªç¯ï¼ˆå³ä¸ºHandlerä½œç›¸å…³çš„å‡†å¤‡å·¥ä½œï¼‰ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è‡ªå·±å®šä¹‰çš„çº¿ç¨‹ä¸­ä½¿ç”¨Handlerçš„è¯ï¼Œåˆ™å¿…é¡»è¦è‡ªå·±è°ƒLooper.prepare()æ¥åˆ›å»ºLooperã€‚</p>
<p>æˆ‘ä»¬åœ¨æ¥çœ‹mainæ–¹æ³•â‘¡å¤„ï¼Œä¼šè°ƒç”¨Looperä¸­loopæ–¹æ³•ã€‚<br>é‚£ä¹ˆloopæ–¹æ³•æ˜¯å¹²ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> Looper me = myLooper();</span><br><span class="line">    ....</span><br><span class="line">    <span class="keyword">final</span> MessageQueue queue = me.mQueue;</span><br><span class="line"></span><br><span class="line">    ....</span><br><span class="line">    <span class="comment">///////////////////////////////</span></span><br><span class="line">    â‘ æ­»å¾ªç¯ã€‚éœ€è¦ä¸åœçš„ä»MessageQueueå»æ¶ˆæ¯è¿›è¡Œå¤„ç†</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        Message msg = queue.next(); <span class="comment">// might block</span></span><br><span class="line">        <span class="keyword">if</span> (msg == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// No message indicates that the message queue is quitting.</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">//////////////////////////////</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">//â‘¡åˆ†å‘æ¶ˆæ¯</span></span><br><span class="line">        msg.target.dispatchMessage(msg);</span><br><span class="line"></span><br><span class="line">        msg.recycle();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œåœ¨loopæ–¹æ³•ä¸­ï¼Œä¸ºäº†æ˜¾å¾—æ¯”è¾ƒæ•´æ´ï¼Œç•¥å»äº†ä¸€äº›ä¸é‡è¦çš„ä»£ç ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹ä¸¤ä¸ªåœ°æ–¹ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹loopæ–¹æ³•çš„â‘ å¤„ï¼Œè¿™é‡Œæ˜¯ä¸ªæ­»å¾ªç¯ï¼Œè¿™é‡Œåˆå¼•å…¥äº†ä¸€ä¸ªæ–°ç±»MessageQueueï¼Œé‚£ä¹ˆMessageQueueæ˜¯ä»€ä¹ˆå‘¢?</p>
<p>MessageQueueç”¨äºå­˜æ”¾ä¸€ä¸ªæ¶ˆæ¯åˆ—è¡¨ï¼Œå…¶æ•°æ®ç»“æ„å°±æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ã€‚ä¸Šé¢çš„nextæ–¹æ³•ä¼šå–å‡ºé˜Ÿåˆ—ä¸­éœ€è¦é©¬ä¸Šå¤„ç†çš„æ¶ˆæ¯ï¼Œå–åˆ°æ¶ˆæ¯åï¼Œæ‰§è¡Œloopæ–¹æ³•ä¸­çš„â‘¡ï¼Œmsgæ˜¯Messageç±»å‹ï¼Œé‚£ä¹ˆMessageçš„targetæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç»§ç»­çœ‹Messageçš„ä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*package*/</span> Handler target;   </span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">Message</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°åœ¨Messageä¸­çš„targetå…¶å®æ˜¯Handlerï¼Œä¸Šé¢â‘¡å¤„ï¼Œåœ¨å–å¾—éœ€è¦å¤„ç†çš„æ¶ˆæ¯åï¼Œç”±æ¶ˆæ¯çš„Handleræ¥åˆ†å‘æ¶ˆæ¯è¿›è¡Œå¤„ç†ã€‚</p>
<p>å¦å¤–ï¼ŒMessageä¸­çš„Handleræ˜¯åœ¨ä»€ä¹ˆæ—¶å€™ä¼ é€’è¿›å»çš„å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸‹Handlerä¸­çš„ç›¸å…³æ–¹æ³•ï¼š</p>
<p>Handlerå‘é€æ¶ˆæ¯ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ„é€ æ¶ˆæ¯çš„æ–¹å¼ï¼š</p>
<ol>
<li>ä½¿ç”¨new ä¸€ä¸ªMessage<br>è¿™ç§æ–¹å¼ï¼Œnew Messageçš„æ–¹å¼ï¼Œå…¶å®Messageæ„é€ æ–¹æ³•å…¶ä¸­æ²¡æœ‰åšä»»ä½•æ“ä½œï¼Œå…³é”®è¿˜æ˜¯åœ¨Handlerè¿™é‡ŒsendMessageæ–¹æ³•ï¼ŒsendMessageæœ€ç»ˆä¼šè°ƒç”¨enqueueMessageï¼Œåœ¨enqueueMessageä¸­å°±è®¾ç½®äº†Messageçš„targetä¸ºthisï¼Œå³Handler</li>
<li>ä½¿ç”¨Handlerä¸­obtainè·å–ä¸€ä¸ªä¿¡æ¯</li>
</ol>
<p>å½“ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼obtainMessageæ¥è·å¾—ä¸€ä¸ªMessageæ—¶ï¼ŒåŒæ ·ä¼šå°†targetç½®ä¸ºHandlerã€‚</p>
<blockquote>
<h5 id="Handlerå‘é€æ¶ˆæ¯çš„æµç¨‹"><a href="#Handlerå‘é€æ¶ˆæ¯çš„æµç¨‹" class="headerlink" title="Handlerå‘é€æ¶ˆæ¯çš„æµç¨‹"></a>Handlerå‘é€æ¶ˆæ¯çš„æµç¨‹</h5></blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">sendMessage</span><span class="params">(Message msg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> sendMessageDelayed(msg, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendMessageAtTime</span><span class="params">(Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</span><br><span class="line">    MessageQueue queue = mQueue;</span><br><span class="line">    <span class="keyword">if</span> (queue == <span class="keyword">null</span>) &#123;</span><br><span class="line">        RuntimeException e = <span class="keyword">new</span> RuntimeException(</span><br><span class="line">                <span class="keyword">this</span> + <span class="string">" sendMessageAtTime() called with no mQueue"</span>);</span><br><span class="line">        Log.w(<span class="string">"Looper"</span>, e.getMessage(), e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> enqueueMessage(queue, msg, uptimeMillis);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">enqueueMessage</span><span class="params">(MessageQueue queue, Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//å°†å½“å‰Messageä¸­targetè®¾ç½®ä¸ºè‡ªå·±ï¼Œå³Handler</span></span><br><span class="line">    msg.target = <span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">if</span> (mAsynchronous) &#123;</span><br><span class="line">        msg.setAsynchronous(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> queue.enqueueMessage(msg, uptimeMillis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Message <span class="title">obtainMessage</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Message.obtain(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Message <span class="title">obtain</span><span class="params">(Handler h)</span> </span>&#123;</span><br><span class="line">    Message m = obtain();</span><br><span class="line">    m.target = h;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> m;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±ä¸Šé¢Handlerå‘é€æ¶ˆæ¯çš„æµç¨‹å¯çŸ¥ï¼ŒHandlerå‘é€æ¶ˆæ¯åMessageQueueä¸­enqueueMessageæ¥å°†æ¶ˆæ¯å…¥é˜Ÿï¼Œæˆ‘ä¹ˆæ¥çœ‹enqueueMessageæ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">enqueueMessage</span><span class="params">(Message msg, <span class="keyword">long</span> when)</span> </span>&#123;</span><br><span class="line">       .....</span><br><span class="line"></span><br><span class="line">       <span class="keyword">boolean</span> needWake;</span><br><span class="line">       .........</span><br><span class="line"></span><br><span class="line">           msg.when = when;</span><br><span class="line">           Message p = mMessages;</span><br><span class="line">           <span class="keyword">if</span> (p == <span class="keyword">null</span> || when == <span class="number">0</span> || when &lt; p.when) &#123;</span><br><span class="line">               </span><br><span class="line">               <span class="comment">//â‘  å½“å‰å‘é€çš„messageéœ€è¦é©¬ä¸Šè¢«å¤„ç†è°ƒï¼ŒneedWakeå”¤é†’çŠ¶æ€ç½®true</span></span><br><span class="line">               </span><br><span class="line">               <span class="comment">// New head, wake up the event queue if blocked.</span></span><br><span class="line">               msg.next = p;</span><br><span class="line">               mMessages = msg;</span><br><span class="line">               needWake = mBlocked;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           </span><br><span class="line">             <span class="comment">// Inserted within the middle of the queue.  Usually we don't have to wake</span></span><br><span class="line">               <span class="comment">// up the event queue unless there is a barrier at the head of the queue</span></span><br><span class="line">               <span class="comment">// and the message is the earliest asynchronous message in the queue.</span></span><br><span class="line">               needWake = mBlocked &amp;&amp; p.target == <span class="keyword">null</span> &amp;&amp; msg.isAsynchronous();</span><br><span class="line">               Message prev;</span><br><span class="line">               </span><br><span class="line">               <span class="comment">// â‘¡ å½“å‰å‘é€çš„messageè¢«æ’é˜Ÿåˆ°å…¶ä»–messageçš„åé¢ï¼ŒneedWakeå”¤é†’çŠ¶æ€ç½®false</span></span><br><span class="line">               </span><br><span class="line">               <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                   prev = p;</span><br><span class="line">                   p = p.next;</span><br><span class="line">                   <span class="keyword">if</span> (p == <span class="keyword">null</span> || when &lt; p.when) &#123;</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="keyword">if</span> (needWake &amp;&amp; p.isAsynchronous()) &#123;</span><br><span class="line">                       needWake = <span class="keyword">false</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">               msg.next = p; <span class="comment">// invariant: p == prev.next</span></span><br><span class="line">               prev.next = msg;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//â‘¢  æ˜¯å¦å”¤é†’ä¸»çº¿ç¨‹</span></span><br><span class="line">       <span class="keyword">if</span> (needWake) &#123;</span><br><span class="line">           nativeWake(mPtr);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨MessageQueueä¸­enqueueMessageæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨ä¸‰ä¸ªåœ°æ–¹ï¼šâ‘ â‘¡â‘¢ï¼Œæ ¹æ®ä¼ è¿›æ¥æ¶ˆæ¯Messageä¸­çš„æ—¶é—´å’Œé˜Ÿåˆ—ä¸­æœ€å‰é¢ä¸€ä¸ªæ¶ˆæ¯çš„æ—¶é—´è¿›è¡Œæ¯”å¯¹ï¼Œåˆ¤æ–­æ˜¯ä¸æ˜¯éœ€è¦åŠæ—¶å¤„ç†ï¼Œè¿˜æ˜¯æ’åˆ°åé¢å»ã€‚</p>
<p>åœ¨â‘ å¤„ï¼Œå½“å‰å‘é€çš„messageéœ€è¦é©¬ä¸Šè¢«å¤„ç†è°ƒï¼ŒneedWakeå”¤é†’çŠ¶æ€ç½®trueã€‚</p>
<p>åœ¨â‘¡å¤„ï¼Œå½“å‰å‘é€çš„messageè¢«æ’é˜Ÿåˆ°å…¶ä»–messageçš„åé¢ï¼ŒneedWakeå”¤é†’çŠ¶æ€ç½®falseã€‚</p>
<p>åœ¨â‘¢å¤„ï¼ŒneedWakeï¼Œæ¥ç¡®å®šæ˜¯å¦å”¤é†’ä¸»çº¿ç¨‹æ¥å¤„ç†æ¶ˆæ¯ã€‚</p>
<p>è¿™æ ·æ¶ˆæ¯å°±èƒ½è¢«å­˜æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå½“éœ€è¦åŠæ—¶å¤„ç†ï¼Œä¼šé€šè¿‡nativeWakeæ¥å”¤é†’ä¸»çº¿ç¨‹ï¼ŒnativeWakeæ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œç”¨jniæ¥å®ç°ï¼ŒHandleræœºåˆ¶ç”¨çš„æ˜¯Linuxä¸‹çš„ä¸€ç§é€šä¿¡æ–¹å¼ï¼Œå«ç®¡é“ã€‚ç®¡é“ï¼ˆPipeï¼‰ï¼Œæ˜¯Linuxä¸­çš„ä¸€ç§è¿›ç¨‹é—´é€šä¿¡æ–¹å¼ï¼Œä½¿ç”¨äº†ç‰¹æ®Šçš„æ–‡ä»¶ï¼Œæœ‰ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆä¸€ä¸ªæ˜¯è¯»å–ï¼Œä¸€ä¸ªæ˜¯å†™å…¥ï¼‰ã€‚å…³äºç®¡é“æœ‰å…´è¶£çš„å¯ä»¥è‡ªå·±ç ”ç©¶çœ‹çœ‹ï¼Œè¿™é‡Œä¸åšè¿‡å¤šä»‹ç»ã€‚</p>
<p>åœ¨Looper.loop()æ–¹æ³•ä¸­,æ²¡æœ‰æ¶ˆæ¯å¤„ç†ï¼Œä¸»çº¿ç¨‹å°±ä¼šé˜»å¡ï¼Œå½“ä¸»çº¿ç¨‹è¢«å­çº¿ç¨‹å”¤é†’åï¼Œä¼šç»§ç»­æ‰§è¡Œï¼Œè¿™æ ·å°±ä¼šæ‰§è¡Œ msg.target.dispatchMessage(msg)æ–¹æ³•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">loop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Looper me = myLooper();</span><br><span class="line">        ....</span><br><span class="line">        <span class="keyword">final</span> MessageQueue queue = me.mQueue;</span><br><span class="line"></span><br><span class="line">        ....</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">            Message msg = queue.next(); <span class="comment">// might block</span></span><br><span class="line">            <span class="keyword">if</span> (msg == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// No message indicates that the message queue is quitting.</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//åˆ†å‘æ¶ˆæ¯</span></span><br><span class="line">            msg.target.dispatchMessage(msg);</span><br><span class="line">            </span><br><span class="line"></span><br><span class="line">            msg.recycle();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>dispatchMessageæ–¹æ³•å¦‚ä¸‹ï¼Œä¼šè°ƒç”¨handleMessageï¼Œè€ŒhandleMessageæ˜¯ä¸ªç©ºæ–¹æ³•ï¼Œæ­£æ˜¯æˆ‘ä»¬éœ€è¦é‡å†™çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¤„ç†æ¶ˆæ¯çš„é€»è¾‘å°±åœ¨è¿™é‡Œï¼Œè¿™æ ·ï¼Œè¿™ä¸ªHandleræœºåˆ¶çš„æµç¨‹å°±èµ°é€šäº†ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dispatchMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (msg.callback != <span class="keyword">null</span>) &#123;</span><br><span class="line">            handleCallback(msg);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (mCallback != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mCallback.handleMessage(msg)) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            handleMessage(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Android">
    <span class="tag-code">Android</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2020/05/21/androidå¯åŠ¨æµç¨‹åˆ†æ/">
        <span class="nav-arrow">â† </span>
        
          androidå¯åŠ¨æµç¨‹åˆ†æ
        
      </a>
    
    
      <a class="nav-right" href="/2020/05/21/è§£å†³CoordinatorLayoutçš„åŠ¨ç”»æŠ–åŠ¨ä»¥åŠå›å¼¹é—®é¢˜/">
        
          è§£å†³CoordinatorLayoutçš„åŠ¨ç”»æŠ–åŠ¨ä»¥åŠå›å¼¹é—®é¢˜
        
        <span class="nav-arrow"> â†’</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- æ‰“èµ START -->
    
    <!-- æ‰“èµ END -->
    <!-- äºŒç»´ç  START -->
    
      <div class="qrcode"></div>
      <p class="notice">å…¬ä¼—å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ˜„</p>
    
    <!-- äºŒç»´ç  END -->
    
      <!-- Utterances START -->
      <div id="utterances"></div>
      <script src="https://utteranc.es/client.js" repo issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>    
      <!-- Utterances END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#Handler-çš„æ„é€ æ–¹æ³•"><span class="toc-nav-text">Handler çš„æ„é€ æ–¹æ³•</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-5"><a class="toc-nav-link" href="#Handlerå‘é€æ¶ˆæ¯çš„æµç¨‹"><span class="toc-nav-text">Handlerå‘é€æ¶ˆæ¯çš„æµç¨‹</span></a></li></ol></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'JasonGaoH.github.io/2020/05/21/ä»æºç è§’åº¦å‰–æHandleræœºåˆ¶/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', '/css/images/error_icon.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== '/css/images/error_icon.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>







    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2023 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    
    
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      hljs.configure({useBR: true});
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>

  </body>
</html>