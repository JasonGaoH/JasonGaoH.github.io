<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="åšæŒè¾“å‡ºï¼ŒåšæŒä¹¦å†™ï¼Œæ‰å¯ä»¥æŒç»­æˆé•¿">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      å…³äºHashMapä½ éœ€è¦çŸ¥é“çš„ä¸€äº›ç»†èŠ‚ | JasonGao Thoughts
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    <script src="/js/qrious.js"></script>
  
  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


  
  
    <script src="/js/local-search.js"></script>

<link rel="alternate" href="atom.xml" title="JasonGao Thoughts" type="application/atom+xml">
</head>
<div class="wechat-share">
  <img src="/css/images/logo.png">
</div>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>JasonGao Thoughts</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
      
        <li class="menu-item menu-item-search right-list">
    <a role="button" class="popup-trigger">
        <i class="fa fa-search fa-fw"></i>
    </a>
</li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
    
      <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
            <span class="search-icon">
                <i class="fa fa-search"></i>
            </span>
            <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="Please enter your keyword(s) to search." spellcheck="false" type="search" class="search-input">
            </div>
            <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>
    
  </div>
</header>

    <div id="article-banner">
  <h2>å…³äºHashMapä½ éœ€è¦çŸ¥é“çš„ä¸€äº›ç»†èŠ‚</h2>
  <p class="post-date">2020-05-21</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><blockquote>
<p>æ–‡ç« å·²åŒæ­¥å‘è¡¨äºå¾®ä¿¡å…¬ä¼—å·JasonGaoHï¼Œ<a href="https://mp.weixin.qq.com/s?__biz=MzUyNTE2OTAzMQ==&amp;mid=2247483757&amp;idx=1&amp;sn=f8cf2e5f82b6cf0e64aab6febf7e7584&amp;chksm=fa237985cd54f0937f9c3c2d3df40b1136602b00d253d2104452ef72319bae6ca7ffcc4f1183&amp;token=1938879438&amp;lang=zh_CN#rd" target="_blank" rel="noopener">å…³äºHashMapä½ éœ€è¦çŸ¥é“çš„ä¸€äº›ç»†èŠ‚</a></p>
</blockquote>
<p>åœ¨å®˜æ–¹æ–‡æ¡£ä¸­çš„æè¿°ï¼š</p>
<blockquote>
<p>Hash table based implementation of the Map interface. This implementation provides all of the optional map operations, and permits null values and the null key. (The HashMap class is roughly equivalent to Hashtable, except that it is unsynchronized and permits nulls.) This class makes no guarantees as to the order of the map; in particular, it does not guarantee that the order will remain constant over time.</p>
</blockquote>
<a id="more"></a>
<blockquote>
<p>åŸºäºMapæ¥å£çš„å“ˆå¸Œè¡¨çš„å®ç°ã€‚æ­¤å®ç°æä¾›æ‰€æœ‰å¯é€‰çš„æ˜ å°„æ“ä½œï¼Œå¹¶å…è®¸ç©ºå€¼å’Œç©ºé”®ã€‚ï¼ˆHashMapç±»å¤§è‡´ç­‰åŒäºHashTableï¼Œåªæ˜¯å®ƒä¸åŒæ­¥å¹¶ä¸”å…è®¸ç©ºå€¼ã€‚ï¼‰è¿™ä¸ªç±»ä¸ä¿è¯æ˜ å°„çš„é¡ºåºï¼›ç‰¹åˆ«æ˜¯ï¼Œå®ƒä¸ä¿è¯é¡ºåºä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œä¿æŒä¸å˜ã€‚</p>
</blockquote>
<h3 id="ä¸¤ä¸ªé‡è¦çš„å‚æ•°"><a href="#ä¸¤ä¸ªé‡è¦çš„å‚æ•°" class="headerlink" title="ä¸¤ä¸ªé‡è¦çš„å‚æ•°"></a>ä¸¤ä¸ªé‡è¦çš„å‚æ•°</h3><p>åœ¨HashMapä¸­æœ‰ä¸¤ä¸ªå¾ˆé‡è¦çš„å‚æ•°ï¼Œå®¹é‡(Capacity)å’Œè´Ÿè½½å› å­(Load factor)</p>
<blockquote>
<ul>
<li>Initial capacity The capacity is the number of buckets in the hash table, The initial capacity is simply the capacity at the time the hash table is created.</li>
<li>Load factor The load factor is a measure of how full the hash table is allowed to get before its capacity is automatically increased.</li>
</ul>
</blockquote>
<p>ç®€å•çš„è¯´ï¼ŒCapacityå°±æ˜¯bucketsçš„æ•°ç›®ï¼ŒLoad factorå°±æ˜¯bucketså¡«æ»¡ç¨‹åº¦çš„æœ€å¤§æ¯”ä¾‹ã€‚å¦‚æœå¯¹è¿­ä»£æ€§èƒ½è¦æ±‚å¾ˆé«˜çš„è¯ä¸è¦æŠŠcapacityè®¾ç½®è¿‡å¤§ï¼Œä¹Ÿä¸è¦æŠŠload factorè®¾ç½®è¿‡å°ã€‚å½“bucketå¡«å……çš„æ•°ç›®ï¼ˆå³hashmapä¸­å…ƒç´ çš„ä¸ªæ•°ï¼‰å¤§äºcapacity*load factoræ—¶å°±éœ€è¦è°ƒæ•´bucketsçš„æ•°ç›®ä¸ºå½“å‰çš„2å€ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥ä¸€èµ·çœ‹çœ‹ HashMap å†…éƒ¨çš„ç»“æ„ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯æ•°ç»„(Node[] table)å’Œé“¾è¡¨ç»“ åˆç»„æˆçš„å¤åˆç»“æ„ï¼Œæ•°ç»„è¢«åˆ†ä¸ºä¸€ä¸ªä¸ªæ¡¶(bucket)ï¼Œé€šè¿‡å“ˆå¸Œå€¼å†³å®šäº†é”®å€¼å¯¹åœ¨è¿™ä¸ªæ•°ç»„çš„å¯»å€;å“ˆå¸Œå€¼ç›¸åŒçš„é”®å€¼å¯¹ï¼Œåˆ™ä»¥é“¾è¡¨å½¢å¼å­˜å‚¨ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„ç¤ºæ„å›¾ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœé“¾è¡¨å¤§å°è¶…è¿‡é˜ˆå€¼(TREEIFY_THRESHOLD, 8)ï¼Œå›¾ä¸­çš„é“¾è¡¨å°±ä¼šè¢«æ”¹é€ ä¸ºæ ‘å½¢ç»“æ„ã€‚</p>
<p><img src="../img/Buckets.jpg" alt></p>
<h3 id="putå‡½æ•°çš„å®ç°"><a href="#putå‡½æ•°çš„å®ç°" class="headerlink" title="putå‡½æ•°çš„å®ç°"></a>putå‡½æ•°çš„å®ç°</h3><p>æ¥ç€æ¥çœ‹ put æ–¹æ³•å®ç°:</p>
<p>putå‡½æ•°å¤§è‡´çš„æ€è·¯ä¸ºï¼š</p>
<ol>
<li>å¯¹keyçš„hashCode()åšhashï¼Œç„¶åå†è®¡ç®—index;</li>
<li>å¦‚æœæ²¡ç¢°æ’ç›´æ¥æ”¾åˆ°bucketé‡Œï¼›</li>
<li>å¦‚æœç¢°æ’äº†ï¼Œä»¥é“¾è¡¨çš„å½¢å¼å­˜åœ¨bucketsåï¼›</li>
<li>å¦‚æœç¢°æ’å¯¼è‡´é“¾è¡¨è¿‡é•¿(å¤§äºç­‰äºTREEIFY_THRESHOLD)ï¼Œå°±æŠŠé“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ï¼›</li>
<li>å¦‚æœèŠ‚ç‚¹å·²ç»å­˜åœ¨å°±æ›¿æ¢old value(ä¿è¯keyçš„å”¯ä¸€æ€§)</li>
<li>å¦‚æœbucketæ»¡äº†(è¶…è¿‡load factor*current capacity)ï¼Œå°±è¦resizeã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¯¹keyçš„hashCode()åšhash</span></span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">               <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">    <span class="comment">// tabä¸ºç©ºåˆ™åˆ›å»º</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">// è®¡ç®—indexï¼Œå¹¶å¯¹nullåšå¤„ç†</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">// èŠ‚ç‚¹å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="comment">// è¯¥é“¾ä¸ºæ ‘</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="comment">// è¯¥é“¾ä¸ºé“¾è¡¨</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å†™å…¥</span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="comment">// è¶…è¿‡load factor*current capacityï¼Œresize</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä» putVal æ–¹æ³•æœ€åˆçš„å‡ è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘ç°å‡ ä¸ªæœ‰æ„æ€çš„åœ°æ–¹:</p>
<ul>
<li>å¦‚æœè¡¨æ ¼æ˜¯ nullï¼Œresize æ–¹æ³•ä¼šè´Ÿè´£åˆå§‹åŒ–å®ƒï¼Œè¿™ä» tab = resize() å¯ä»¥çœ‹å‡ºã€‚</li>
<li>resize æ–¹æ³•å…¼é¡¾ä¸¤ä¸ªèŒè´£ï¼Œåˆ›å»ºåˆå§‹å­˜å‚¨è¡¨æ ¼ï¼Œæˆ–è€…åœ¨å®¹é‡ä¸æ»¡è¶³éœ€æ±‚çš„æ—¶å€™ï¼Œè¿›è¡Œæ‰©å®¹ (resize)ã€‚</li>
<li>åœ¨æ”¾ç½®æ–°çš„é”®å€¼å¯¹çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå‘ç”Ÿä¸‹é¢æ¡ä»¶ï¼Œå°±ä¼šå‘ç”Ÿæ‰©å®¹ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">resize();</span><br></pre></td></tr></table></figure>
<ul>
<li>å…·ä½“é”®å€¼å¯¹åœ¨å“ˆå¸Œè¡¨ä¸­çš„ä½ç½®(æ•°ç»„ index)å–å†³äºä¸‹é¢çš„ä½è¿ç®—:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i = (n - <span class="number">1</span>) &amp; hash</span><br></pre></td></tr></table></figure>
<p>ä»”ç»†è§‚å¯Ÿå“ˆå¸Œå€¼çš„æºå¤´ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œå®ƒå¹¶ä¸æ˜¯ key æœ¬èº«çš„ hashCodeï¼Œè€Œæ˜¯æ¥è‡ªäº HashMap å†…éƒ¨çš„å¦å¤–ä¸€ä¸ª hash æ–¹æ³•ã€‚æ³¨æ„ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œéœ€è¦å°†é«˜ä½æ•°æ®ç§»ä½åˆ°ä½ä½è¿›è¡Œå¼‚æˆ–è¿ç®—å‘¢?è¿™æ˜¯å› ä¸ºæœ‰äº›æ•°æ®è®¡ç®—å‡ºçš„å“ˆå¸Œå€¼å·®å¼‚ä¸»è¦åœ¨é«˜ä½ï¼Œè€Œ HashMap é‡Œçš„å“ˆå¸Œå¯»å€æ˜¯å¿½ ç•¥å®¹é‡ä»¥ä¸Šçš„é«˜ä½çš„ï¼Œé‚£ä¹ˆè¿™ç§å¤„ç†å°±å¯ä»¥æœ‰æ•ˆé¿å…ç±»ä¼¼æƒ…å†µä¸‹çš„å“ˆå¸Œç¢°æ’ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object kye)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt;<span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æˆ‘å‰é¢æåˆ°çš„é“¾è¡¨ç»“æ„(è¿™é‡Œå« bin)ï¼Œä¼šåœ¨è¾¾åˆ°ä¸€å®šé—¨é™å€¼æ—¶ï¼Œå‘ç”Ÿæ ‘åŒ–ï¼Œæˆ‘ç¨åä¼šåˆ†æ ä¸ºä»€ä¹ˆ HashMap éœ€è¦å¯¹ bin è¿›è¡Œå¤„ç†ã€‚</li>
</ul>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒputVal æ–¹æ³•æœ¬èº«é€»è¾‘éå¸¸é›†ä¸­ï¼Œä»åˆå§‹åŒ–ã€æ‰©å®¹åˆ°æ ‘åŒ–ï¼Œå…¨éƒ¨éƒ½å’Œå®ƒæœ‰å…³ã€‚</p>
<p>è¿›ä¸€æ­¥åˆ†æä¸€ä¸‹èº«å…¼å¤šèŒçš„ resize æ–¹æ³•ï¼Œå¾ˆå¤šæœ‹å‹éƒ½åé¦ˆç»å¸¸è¢«é¢è¯•å®˜è¿½é—®å®ƒçš„æºç è®¾è®¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACIY &amp;&amp;</span><br><span class="line">                oldCap &gt;= DEFAULT_INITIAL_CAPAITY)</span><br><span class="line">        newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double there</span></span><br><span class="line">       <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">        newCap = oldThr;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// zero initial threshold signifies using defaultsfults newCap = DEFAULT_INITIAL_CAPAITY;</span></span><br><span class="line">        newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_ATOR* DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (newThr ==<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFator;</span><br><span class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?(<span class="keyword">int</span>)ft : Intege</span><br><span class="line">    &#125;</span><br><span class="line">    threshold = neThr;</span><br><span class="line">    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newap]; table = n;</span><br><span class="line">    <span class="comment">// ç§»åŠ¨åˆ°æ–°çš„æ•°ç»„ç»“æ„ e æ•°ç»„ç»“æ„ &#125;</span></span><br></pre></td></tr></table></figure>
<p>ä¾æ® resize æºç ï¼Œä¸è€ƒè™‘æç«¯æƒ…å†µ(å®¹é‡ç†è®ºæœ€å¤§æé™ç”± MAXIMUM_CAPACITY æŒ‡å®šï¼Œæ•°å€¼ ä¸º 1&lt;&lt;30ï¼Œä¹Ÿå°±æ˜¯ 2 çš„ 30 æ¬¡æ–¹)ï¼Œæˆ‘ä»¬å¯ä»¥å½’çº³ä¸º:</p>
<ul>
<li>é—¨é™å€¼ç­‰äº(è´Ÿè½½å› å­)x(å®¹é‡)ï¼Œå¦‚æœæ„å»º HashMap çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šå®ƒä»¬ï¼Œé‚£ä¹ˆå°±æ˜¯ä¾ æ®ç›¸åº”çš„é»˜è®¤å¸¸é‡å€¼ã€‚</li>
<li>é—¨é™é€šå¸¸æ˜¯ä»¥å€æ•°è¿›è¡Œè°ƒæ•´ (newThr = oldThr &lt;&lt; 1)ï¼Œæˆ‘å‰é¢æåˆ°ï¼Œæ ¹æ® putVal ä¸­çš„é€» è¾‘ï¼Œå½“å…ƒç´ ä¸ªæ•°è¶…è¿‡é—¨é™å¤§å°æ—¶ï¼Œåˆ™è°ƒæ•´ Map å¤§å°ã€‚</li>
<li>æ‰©å®¹åï¼Œéœ€è¦å°†è€çš„æ•°ç»„ä¸­çš„å…ƒç´ é‡æ–°æ”¾ç½®åˆ°æ–°çš„æ•°ç»„ï¼Œè¿™æ˜¯æ‰©å®¹çš„ä¸€ä¸ªä¸»è¦å¼€é”€æ¥æºã€‚</li>
</ul>
<h3 id="å®¹é‡ã€è´Ÿè½½å› å­"><a href="#å®¹é‡ã€è´Ÿè½½å› å­" class="headerlink" title="å®¹é‡ã€è´Ÿè½½å› å­"></a>å®¹é‡ã€è´Ÿè½½å› å­</h3><p>å‰é¢æˆ‘ä»¬å¿«é€Ÿæ¢³ç†äº†ä¸€ä¸‹ HashMap ä»åˆ›å»ºåˆ°æ”¾å…¥é”®å€¼å¯¹çš„ç›¸å…³é€»è¾‘ï¼Œç°åœ¨æ€è€ƒä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆ æˆ‘ä»¬éœ€è¦åœ¨ä¹å®¹é‡å’Œè´Ÿè½½å› å­å‘¢?</p>
<p>è¿™æ˜¯å› ä¸ºå®¹é‡å’Œè´Ÿè½½ç³»æ•°å†³å®šäº†å¯ç”¨çš„æ¡¶çš„æ•°é‡ï¼Œç©ºæ¡¶å¤ªå¤šä¼šæµªè´¹ç©ºé—´ï¼Œå¦‚æœä½¿ç”¨çš„å¤ªæ»¡åˆ™ä¼šä¸¥<br>é‡å½±å“æ“ä½œçš„æ€§èƒ½ã€‚æç«¯æƒ…å†µä¸‹ï¼Œå‡è®¾åªæœ‰ä¸€ä¸ªæ¡¶ï¼Œé‚£ä¹ˆå®ƒå°±é€€åŒ–æˆäº†é“¾è¡¨ï¼Œå®Œå…¨ä¸èƒ½æä¾›æ‰€è°“<br>å¸¸æ•°æ—¶é—´å­˜å‚¨çš„æ€§èƒ½ã€‚<br>æ—¢ç„¶å®¹é‡å’Œè´Ÿè½½å› å­è¿™ä¹ˆé‡è¦ï¼Œæˆ‘ä»¬åœ¨å®è·µä¸­åº”è¯¥å¦‚ä½•é€‰æ‹©å‘¢?</p>
<p>å¦‚æœèƒ½å¤ŸçŸ¥é“ HashMap è¦å­˜å–çš„é”®å€¼å¯¹æ•°é‡ï¼Œå¯ä»¥è€ƒè™‘é¢„å…ˆè®¾ç½®åˆé€‚çš„å®¹é‡å¤§å°ã€‚å…·ä½“æ•°å€¼ æˆ‘ä»¬å¯ä»¥æ ¹æ®æ‰©å®¹å‘ç”Ÿçš„æ¡ä»¶æ¥åšç®€å•é¢„ä¼°ï¼Œæ ¹æ®å‰é¢çš„ä»£ç åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“å®ƒéœ€è¦ç¬¦åˆè®¡ç®—æ¡ä»¶:</p>
<p>è´Ÿè½½å› å­ * å®¹é‡ &gt; å…ƒç´ æ•°é‡</p>
<p>æ‰€ä»¥ï¼Œé¢„å…ˆè®¾ç½®çš„å®¹é‡éœ€è¦æ»¡è¶³ï¼Œå¤§äºâ€œé¢„ä¼°å…ƒç´ æ•°é‡ / è´Ÿè½½å› å­â€ï¼ŒåŒæ—¶å®ƒæ˜¯ 2 çš„å¹‚æ•°ï¼Œç»“è®ºå·²ç»éå¸¸æ¸…æ™°äº†ã€‚</p>
<p>è€Œå¯¹äºè´Ÿè½½å› å­ï¼Œæˆ‘å»ºè®®:</p>
<ul>
<li><p>å¦‚æœæ²¡æœ‰ç‰¹åˆ«éœ€æ±‚ï¼Œä¸è¦è½»æ˜“è¿›è¡Œæ›´æ”¹ï¼Œå› ä¸º JDK è‡ªèº«çš„é»˜è®¤è´Ÿè½½å› å­æ˜¯éå¸¸ç¬¦åˆé€šç”¨åœºæ™¯çš„éœ€æ±‚çš„ã€‚</p>
</li>
<li><p>å¦‚æœç¡®å®éœ€è¦è°ƒæ•´ï¼Œå»ºè®®ä¸è¦è®¾ç½®è¶…è¿‡ 0.75 çš„æ•°å€¼ï¼Œå› ä¸ºä¼šæ˜¾è‘—å¢åŠ å†²çªï¼Œé™ä½ HashMap çš„æ€§èƒ½ã€‚</p>
</li>
<li>å¦‚æœä½¿ç”¨å¤ªå°çš„è´Ÿè½½å› å­ï¼ŒæŒ‰ç…§ä¸Šé¢çš„å…¬å¼ï¼Œé¢„è®¾å®¹é‡å€¼ä¹Ÿè¿›è¡Œè°ƒæ•´ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´æ›´åŠ <br>é¢‘ç¹çš„æ‰©å®¹ï¼Œå¢åŠ æ— è°“çš„å¼€é”€ï¼Œæœ¬èº«è®¿é—®æ€§èƒ½ä¹Ÿä¼šå—å½±å“ã€‚</li>
</ul>
<h3 id="æ ‘åŒ–æ”¹é€ "><a href="#æ ‘åŒ–æ”¹é€ " class="headerlink" title="æ ‘åŒ–æ”¹é€ "></a>æ ‘åŒ–æ”¹é€ </h3><p> æˆ‘ä»¬å‰é¢æåˆ°äº†æ ‘åŒ–æ”¹é€ ï¼Œå¯¹åº”é€»è¾‘ä¸»è¦åœ¨ putVal å’Œ treeifyBin ä¸­ã€‚</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">treeifyBin</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> hash)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, index; Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">if</span> (tab == <span class="keyword">null</span> || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY)</span><br><span class="line">        resize();</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ((e = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// æ ‘åŒ–æ”¹é€ é€»è¾‘ </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æ˜¯ç²¾ç®€è¿‡çš„ treeifyBin ç¤ºæ„ï¼Œç»¼åˆè¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œæ ‘åŒ–æ”¹é€ çš„é€»è¾‘å°±éå¸¸æ¸…æ™°äº†ï¼Œå¯ä»¥ç†è§£ä¸ºï¼Œå½“ bin çš„æ•°é‡å¤§äº TREEIFY_THRESHOLD æ—¶:</p>
<ul>
<li>å¦‚æœå®¹é‡å°äº MIN_TREEIFY_CAPACITYï¼Œåªä¼šè¿›è¡Œç®€å•çš„æ‰©å®¹ã€‚</li>
<li>å¦‚æœå®¹é‡å¤§äº MIN_TREEIFY_CAPACITY ï¼Œåˆ™ä¼šè¿›è¡Œæ ‘åŒ–æ”¹é€ ã€‚ </li>
</ul>
<p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆ HashMap è¦æ ‘åŒ–å‘¢?</p>
<p>æœ¬è´¨ä¸Šè¿™æ˜¯ä¸ªå®‰å…¨é—®é¢˜ã€‚å› ä¸ºåœ¨å…ƒç´ æ”¾ç½®è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡å“ˆå¸Œå†²çªï¼Œéƒ½è¢«æ”¾ç½®åˆ°åŒä¸€ä¸ªæ¡¶<br>é‡Œï¼Œåˆ™ä¼šå½¢æˆä¸€ä¸ªé“¾è¡¨ï¼Œæˆ‘ä»¬çŸ¥é“é“¾è¡¨æŸ¥è¯¢æ˜¯çº¿æ€§çš„ï¼Œä¼šä¸¥é‡å½±å“å­˜å–çš„æ€§èƒ½ã€‚</p>
<h3 id="hashå‡½æ•°çš„å®ç°"><a href="#hashå‡½æ•°çš„å®ç°" class="headerlink" title="hashå‡½æ•°çš„å®ç°"></a>hashå‡½æ•°çš„å®ç°</h3><p>æ¥ç€æˆ‘ä»¬ç€é‡æ¥çœ‹hashå‡½æ•°çš„å®ç°ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object kye)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt;<span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿™æ®µä»£ç å®é™…ä¸Šç§°ä¸ºâ€œæ‰°åŠ¨å‡½æ•°â€ï¼ŒJava 8çš„ä»£ç ç›¸å¯¹Java 7æ˜¯åšè¿‡ç®€åŒ–çš„ï¼Œä½†åŸç†æ˜¯ä¸å˜çš„ã€‚</p>
<p>æˆ‘ä»¬éƒ½çŸ¥é“ä¸Šé¢ä»£ç é‡Œçš„key.hashCode()å‡½æ•°è°ƒç”¨çš„æ˜¯keyé”®å€¼ç±»å‹è‡ªå¸¦çš„å“ˆå¸Œå‡½æ•°ï¼Œè¿”å›intå‹æ•£åˆ—å€¼ã€‚</p>
<p>ç†è®ºä¸ŠhashCodeæ˜¯ä¸€ä¸ªintå€¼ï¼Œè¿™ä¸ªintå€¼èŒƒå›´åœ¨-2147483648å’Œ2147483648ä¹‹é—´ï¼Œå¦‚æœç›´æ¥æ‹¿è¿™ä¸ªhashCodeä½œä¸ºHashMapä¸­æ•°ç»„çš„ä¸‹æ ‡æ¥è®¿é—®çš„è¯ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ˜¯ä¸ä¼šå‡ºç°hashç¢°æ’çš„ã€‚<br>ä½†æ˜¯è¿™æ ·çš„è¯ä¼šå¯¼è‡´è¿™ä¸ªHashMapçš„æ•°ç»„é•¿åº¦æ¯”è¾ƒé•¿ï¼Œé•¿åº¦å¤§æ¦‚ä¸º40äº¿ï¼Œå†…å­˜è‚¯å®šæ˜¯æ”¾ä¸ä¸‹çš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™éœ€è¦æŠŠè¿™ä¸ªhashCodeå¯¹æ•°ç»„é•¿åº¦å–ä½™ï¼Œç”¨å¾—åˆ°çš„ä½™æ•°æ¥è®¿é—®æ•°ç»„ä¸‹æ ‡ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°HashMapä¸­getæ–¹æ³•å’Œputæ–¹æ³•éƒ½æœ‰ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tab[(n - <span class="number">1</span>) &amp; hash]</span><br></pre></td></tr></table></figure></p>
<p>(n-1)&amp;hashå®é™…ä¸Šç›¸å½“äºhash%nå–ä½™æ•°ï¼Œä½†&amp;è®¡ç®—é€Ÿåº¦æ›´å¿«ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼š<br>ä»¥åˆå§‹é•¿åº¦ä¸º16ä¸ºä¾‹ï¼Œ16-1=15ã€‚2è¿›åˆ¶è¡¨ç¤ºæ˜¯00000000 00000000 00001111ã€‚<br>æˆ‘ä»¬æŠŠ15å’ŒæŸhashCodeå€¼åšâ€œä¸â€æ“ä½œå¦‚ä¸‹ï¼Œç»“æœå°±æ˜¯æˆªå–äº†æœ€ä½çš„å››ä½å€¼ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">    <span class="number">10100101</span> <span class="number">11000100</span> <span class="number">00100101</span></span><br><span class="line">&amp;	<span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00001111</span></span><br><span class="line">----------------------------------</span><br><span class="line">	<span class="number">00000000</span> <span class="number">00000000</span> <span class="number">00000101</span>    <span class="comment">//é«˜ä½å…¨éƒ¨å½’é›¶ï¼Œåªä¿ç•™æœ«å››ä½</span></span><br></pre></td></tr></table></figure></p>
<p>è¿™æ ·é—®é¢˜å°±æ¥äº†ï¼Œæˆ‘ä»¬å¦‚æœåªæ˜¯å–ä½ä½çš„æƒ…å†µä¸‹ï¼Œç¢°æ’å°±ä¼šå¾ˆä¸¥é‡ã€‚</p>
<p>è¿™æ—¶å€™â€œæ‰°åŠ¨å‡½æ•°â€çš„ä»·å€¼å°±ä½“ç°å‡ºæ¥äº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢è¿™å¼ å›¾ç‰‡ï¼š<br><img src="../img/hashmap_hash.jpg" alt></p>
<p>å³ä½ç§»16ä½ï¼Œæ­£å¥½æ˜¯32bitçš„ä¸€åŠï¼Œè‡ªå·±çš„é«˜åŠåŒºå’Œä½åŠåŒºåšå¼‚æˆ–ï¼Œå°±æ˜¯ä¸ºäº†æ··åˆåŸå§‹å“ˆå¸Œç çš„é«˜ä½å’Œä½ä½ï¼Œä»¥æ­¤æ¥åŠ å¤§ä½ä½çš„éšæœºæ€§ã€‚è€Œä¸”æ··åˆåçš„ä½ä½æºæ‚äº†é«˜ä½çš„éƒ¨åˆ†ç‰¹å¾ï¼Œè¿™æ ·é«˜ä½çš„ä¿¡æ¯ä¹Ÿè¢«å˜ç›¸ä¿ç•™ä¸‹æ¥ã€‚</p>
<p>è¿™æ ·å¤§å¤šæ•°çš„hashCodeçš„åˆ†å¸ƒå·²ç»å¾ˆä¸é”™äº†ï¼Œå°±ç®—æ˜¯å‘ç”Ÿäº†ç¢°æ’ä¹Ÿç”¨O(logn)çš„treeå»åšäº†ã€‚ä»…ä»…å¼‚æˆ–ä¸€ä¸‹ï¼Œæ—¢å‡å°‘äº†ç³»ç»Ÿçš„å¼€é”€ï¼Œä¹Ÿä¸ä¼šé€ æˆçš„å› ä¸ºé«˜ä½æ²¡æœ‰å‚ä¸ä¸‹æ ‡çš„è®¡ç®—(tableé•¿åº¦æ¯”è¾ƒå°æ—¶)ï¼Œä»è€Œå¼•èµ·çš„ç¢°æ’ã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯å…³äºHashMapä¸­hashå‡½æ•°è®¾è®¡çš„åŸç†ã€‚</p>
<h3 id="resizeçš„å®ç°åŸç†"><a href="#resizeçš„å®ç°åŸç†" class="headerlink" title="resizeçš„å®ç°åŸç†"></a>resizeçš„å®ç°åŸç†</h3><p>å½“putæ—¶ï¼Œå¦‚æœå‘ç°ç›®å‰çš„bucketå ç”¨ç¨‹åº¦å·²ç»è¶…è¿‡äº†Load Factoræ‰€å¸Œæœ›çš„æ¯”ä¾‹ï¼Œé‚£ä¹ˆå°±ä¼šå‘ç”Ÿresizeã€‚åœ¨resizeçš„è¿‡ç¨‹ï¼Œç®€å•çš„è¯´å°±æ˜¯æŠŠbucketæ‰©å……ä¸º2å€ï¼Œä¹‹åé‡æ–°è®¡ç®—indexï¼ŒæŠŠèŠ‚ç‚¹å†æ”¾åˆ°æ–°çš„bucketä¸­ã€‚resizeçš„æ³¨é‡Šæ˜¯è¿™æ ·æè¿°çš„ï¼š</p>
<blockquote>
<p>Initializes or doubles table size. If null, allocates in accord with initial capacity target held in field threshold. Otherwise, because we are using power-of-two expansion, the elements from each bin must either stay at same index, or move with a power of two offset in the new table.</p>
</blockquote>
<p>å¤§è‡´æ„æ€å°±æ˜¯è¯´ï¼Œå½“è¶…è¿‡é™åˆ¶çš„æ—¶å€™ä¼šresizeï¼Œç„¶è€Œåˆå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯2æ¬¡å¹‚çš„æ‰©å±•(æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥2å€)ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚</p>
<p><img src="../img/hashmap_resize.jpg" alt></p>
<p>æˆ‘ä»¬æ¥ä¸Šé¢è¿™å¼ å›¾ï¼Œnä¸ºtableçš„é•¿åº¦ï¼Œå›¾ï¼ˆaï¼‰è¡¨ç¤ºæ‰©å®¹å‰çš„key1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå›¾ï¼ˆbï¼‰è¡¨ç¤ºæ‰©å®¹åkey1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå…¶ä¸­hash1æ˜¯key1å¯¹åº”çš„å“ˆå¸Œå€¼(ä¹Ÿå°±æ˜¯æ ¹æ®key1ç®—å‡ºæ¥çš„hashcodeå€¼)ä¸é«˜ä½ä¸è¿ç®—çš„ç»“æœã€‚</p>
<p>å…ƒç´ åœ¨é‡æ–°è®¡ç®—hashä¹‹åï¼Œå› ä¸ºnå˜ä¸º2å€ï¼Œé‚£ä¹ˆn-1çš„maskèŒƒå›´åœ¨é«˜ä½å¤š1bit(çº¢è‰²)ï¼Œå› æ­¤æ–°çš„indexå°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š<br><img src="../img/hashmap_resize2.jpg" alt></p>
<p> è¿™æ ·æˆ‘ä»¬resizeçš„æ—¶å€™ï¼Œä¸éœ€è¦åƒJDK1.7çš„å®ç°é‚£æ ·é‡æ–°è®¡ç®—hashï¼Œåªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯1çš„è¯ç´¢å¼•å˜æˆâ€œåŸç´¢å¼•+oldCapã€‚</p>
<p> è¿™ä¸ªå°±æ˜¯resizeè®¾è®¡å·§å¦™çš„åœ°æ–¹ï¼Œåœ¨æ‰©å®¹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸éœ€è¦é‡æ–°å»è®¡ç®—hashçš„å€¼ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚</p>
<h3 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h3><p> <a href="https://yikun.github.io/2015/04/01/Java-HashMap%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E5%8F%8A%E5%AE%9E%E7%8E%B0/" target="_blank" rel="noopener">Java HashMapå·¥ä½œåŸç†åŠå®ç°</a></p>
<p><a href="https://www.zhihu.com/question/20733617" target="_blank" rel="noopener">HashMap çš„ hash æ–¹æ³•åŸç†</a></p>
<p><a href="https://blog.csdn.net/u012961566/article/details/72963157" target="_blank" rel="noopener">HashMapçš„æ‰©å®¹æœºåˆ¶</a></p>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#HashMap">
    <span class="tag-code">HashMap</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2020/05/21/ConcurrentHashMapæ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„/">
        <span class="nav-arrow">â† </span>
        
          ConcurrentHashMapæ˜¯å¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨çš„
        
      </a>
    
    
      <a class="nav-right" href="/2020/05/21/synchronizedå…³é”®å­—çš„åŸç†/">
        
          synchronizedå…³é”®å­—çš„åŸç†
        
        <span class="nav-arrow"> â†’</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- æ‰“èµ START -->
    
    <!-- æ‰“èµ END -->
    <!-- äºŒç»´ç  START -->
    
      <div class="qrcode"></div>
      <p class="notice">å…¬ä¼—å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ˜„</p>
    
    <!-- äºŒç»´ç  END -->
    
      <!-- Utterances START -->
      <div id="utterances"></div>
      <script src="https://utteranc.es/client.js" repo issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script>    
      <!-- Utterances END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
    <aside class="catalog-container">
  <div class="toc-main">
    <strong class="toc-title">Catalog</strong>
    
      <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#ä¸¤ä¸ªé‡è¦çš„å‚æ•°"><span class="toc-nav-text">ä¸¤ä¸ªé‡è¦çš„å‚æ•°</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#putå‡½æ•°çš„å®ç°"><span class="toc-nav-text">putå‡½æ•°çš„å®ç°</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#å®¹é‡ã€è´Ÿè½½å› å­"><span class="toc-nav-text">å®¹é‡ã€è´Ÿè½½å› å­</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#æ ‘åŒ–æ”¹é€ "><span class="toc-nav-text">æ ‘åŒ–æ”¹é€ </span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#hashå‡½æ•°çš„å®ç°"><span class="toc-nav-text">hashå‡½æ•°çš„å®ç°</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#resizeçš„å®ç°åŸç†"><span class="toc-nav-text">resizeçš„å®ç°åŸç†</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#å‚è€ƒæ–‡ç« "><span class="toc-nav-text">å‚è€ƒæ–‡ç« </span></a></li></ol>
    
  </div>
</aside>
  
  <!-- Catalog END -->
</main>

<script>
  (function () {
    var url = 'JasonGaoH.github.io/2020/05/21/å…³äºHashMapä½ éœ€è¦çŸ¥é“çš„ä¸€äº›ç»†èŠ‚/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', '/css/images/error_icon.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== '/css/images/error_icon.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>







    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2023 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    
    
  </p>
</footer>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      hljs.configure({useBR: true});
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>

  </body>
</html>