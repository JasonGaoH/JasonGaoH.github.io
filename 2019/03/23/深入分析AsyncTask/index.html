<!DOCTYPE html>
<html>
  <head><meta name="generator" content="Hexo 3.8.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <meta name="description" content="åšæŒè¾“å‡ºï¼ŒåšæŒä¹¦å†™ï¼Œæ‰å¯ä»¥æŒç»­æˆé•¿">
  <meta name="keyword" content="hexo-theme, vuejs">
  
    <link rel="shortcut icon" href="/css/images/logo.png">
  
  <title>
    
      æ·±å…¥åˆ†æAsyncTask | JasonGao Thoughts
    
  </title>
  <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.css" rel="stylesheet">
  <link href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/tomorrow.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/geopattern/1.2.3/js/geopattern.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script>
  
    <script src="/js/qrious.js"></script>
  
  
  
  
    <!-- MathJax support START -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- MathJax support END -->
  


  
  
    <script src="/js/local-search.js"></script>

<link rel="alternate" href="atom.xml" title="JasonGao Thoughts" type="application/atom+xml">
</head>
<div class="wechat-share">
  <img src="/css/images/logo.png">
</div>
  <body>
    <header class="header fixed-header">
  <div class="header-container">
    <a class="home-link" href="/">
      <div class="logo"></div>
      <span>JasonGao Thoughts</span>
    </a>
    <ul class="right-list">
      
        <li class="list-item">
          
            <a href="/" class="item-link">Home</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/tags/" class="item-link">Tags</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/archives/" class="item-link">Archives</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/project/" class="item-link">Projects</a>
          
        </li>
      
        <li class="list-item">
          
            <a href="/about/" class="item-link">About</a>
          
        </li>
      
      
        <li class="menu-item menu-item-search right-list">
    <a role="button" class="popup-trigger">
        <i class="fa fa-search fa-fw"></i>
    </a>
</li>
      
    </ul>
    <div class="menu">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </div>
    <div class="menu-mask">
      <ul class="menu-list">
        
          <li class="menu-item">
            
              <a href="/" class="menu-link">Home</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/tags/" class="menu-link">Tags</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/archives/" class="menu-link">Archives</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/project/" class="menu-link">Projects</a>
            
          </li>
        
          <li class="menu-item">
            
              <a href="/about/" class="menu-link">About</a>
            
          </li>
        
      </ul>
    </div>
    
      <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
            <span class="search-icon">
                <i class="fa fa-search"></i>
            </span>
            <div class="search-input-container">
                <input autocomplete="off" autocapitalize="off" placeholder="Please enter your keyword(s) to search." spellcheck="false" type="search" class="search-input">
            </div>
            <span class="popup-btn-close">
                <i class="fa fa-times-circle"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>
    
  </div>
</header>

    <div id="article-banner">
  <h2>æ·±å…¥åˆ†æAsyncTask</h2>
  <p class="post-date">2019-03-23</p>
  <div class="arrow-down">
    <a href="javascript:;"></a>
  </div>
</div>
<main class="app-body flex-box">
  <!-- Article START -->
  <article class="post-article">
    <section class="markdown-content"><ol>
<li>ä»€ä¹ˆæ˜¯AsyncTask</li>
</ol>
<hr>
<p>AsyncTask å³ asynchronous taskï¼Œå¼‚æ­¥ä»»åŠ¡ã€‚</p>
<p>AsyncTaskå®é™…ä¸Šæ˜¯å›´ç»•Threadå’ŒHandlerè®¾è®¡çš„ä¸€ä¸ªè¾…åŠ©ç±»ï¼Œåœ¨å†…éƒ¨æ˜¯å¯¹Threadå’ŒHandlerçš„ä¸€ç§å°è£…ã€‚AsyncTaskçš„å¼‚æ­¥ä½“ç°åœ¨ç”±åå°çº¿ç¨‹è¿›è¡Œè¿ç®—ï¼ˆè®¿é—®ç½‘ç»œç­‰æ¯”è¾ƒè€—æ—¶çš„æ“ä½œï¼‰ï¼Œç„¶åå°†ç»“æœå‘å¸ƒåˆ°ç”¨æˆ·ç•Œé¢ä¸Šæ¥æ›´æ–°UIï¼Œä½¿ç”¨AsyncTaskä½¿å¾—æˆ‘ä¸ç”¨æ“ä½œThreadå’ŒHandlerã€‚<br> <a id="more"></a></p>
<ol start="2">
<li>AsyncTaskçš„ç®€å•ä½¿ç”¨</li>
</ol>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">new AsyncTask&lt;String,String,String&gt;()&#123;</span><br><span class="line">    //// è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œåšé¢„å¤‡å·¥ä½œ/////</span><br><span class="line">    onPreExecute()&#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    // è¿è¡Œåœ¨å­çº¿ç¨‹ä¸­ï¼Œåšè€—æ—¶æ“ä½œ</span><br><span class="line">    String doingBackGround(String s)&#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    // è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œè€—æ—¶æ“ä½œå®Œæˆï¼Œæ›´æ–°UI</span><br><span class="line">    onPostExecute(String s)&#123;</span><br><span class="line">    			</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;.execute(String);</span><br></pre></td></tr></table></figure>
<p>AsyncTaskç”¨æ³•æ¯”è¾ƒç®€å•ï¼ŒGoogleè®¾è®¡è¿™ä¸ªç±»å°±æ˜¯ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œç±»ä¼¼Handlerè¿™æ ·çš„å¼‚æ­¥æ“ä½œã€‚</p>
<h5 id="å¦‚ä¸Šä»£ç ï¼Œä¸€èˆ¬ä½¿ç”¨AsyncTaskåªè¦é‡å†™é‡Œé¢çš„ä¸‰ä¸ªæ–¹æ³•ï¼ŒonPreExecuteå’ŒonPostExecuteä¸æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œä¸æ˜¯å¿…é¡»å®ç°ï¼Œå®ç°è¿™ä¸¤ç§æ–¹æ³•ä¸€èˆ¬èƒ½è®©ä»£ç çš„é€»è¾‘æ›´åŠ æ¸…æ™°ã€‚onPreExecuteè¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œåšä¸€äº›å‡†å¤‡å·¥ä½œã€‚onPostExecuteåŒæ ·è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œç”¨äºåœ¨è€—æ—¶æ“ä½œå®Œæˆåï¼Œæ›´æ–°UIã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªonProgressUpdateæ–¹æ³•ï¼Œç”¨äºåœ¨åå°ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ¥å®æ—¶åœ°æ›´æ–°UIã€‚"><a href="#å¦‚ä¸Šä»£ç ï¼Œä¸€èˆ¬ä½¿ç”¨AsyncTaskåªè¦é‡å†™é‡Œé¢çš„ä¸‰ä¸ªæ–¹æ³•ï¼ŒonPreExecuteå’ŒonPostExecuteä¸æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œä¸æ˜¯å¿…é¡»å®ç°ï¼Œå®ç°è¿™ä¸¤ç§æ–¹æ³•ä¸€èˆ¬èƒ½è®©ä»£ç çš„é€»è¾‘æ›´åŠ æ¸…æ™°ã€‚onPreExecuteè¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œåšä¸€äº›å‡†å¤‡å·¥ä½œã€‚onPostExecuteåŒæ ·è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œç”¨äºåœ¨è€—æ—¶æ“ä½œå®Œæˆåï¼Œæ›´æ–°UIã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªonProgressUpdateæ–¹æ³•ï¼Œç”¨äºåœ¨åå°ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ¥å®æ—¶åœ°æ›´æ–°UIã€‚" class="headerlink" title="å¦‚ä¸Šä»£ç ï¼Œä¸€èˆ¬ä½¿ç”¨AsyncTaskåªè¦é‡å†™é‡Œé¢çš„ä¸‰ä¸ªæ–¹æ³•ï¼ŒonPreExecuteå’ŒonPostExecuteä¸æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œä¸æ˜¯å¿…é¡»å®ç°ï¼Œå®ç°è¿™ä¸¤ç§æ–¹æ³•ä¸€èˆ¬èƒ½è®©ä»£ç çš„é€»è¾‘æ›´åŠ æ¸…æ™°ã€‚onPreExecuteè¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œåšä¸€äº›å‡†å¤‡å·¥ä½œã€‚onPostExecuteåŒæ ·è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œç”¨äºåœ¨è€—æ—¶æ“ä½œå®Œæˆåï¼Œæ›´æ–°UIã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªonProgressUpdateæ–¹æ³•ï¼Œç”¨äºåœ¨åå°ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ¥å®æ—¶åœ°æ›´æ–°UIã€‚"></a>å¦‚ä¸Šä»£ç ï¼Œä¸€èˆ¬ä½¿ç”¨AsyncTaskåªè¦é‡å†™é‡Œé¢çš„ä¸‰ä¸ªæ–¹æ³•ï¼ŒonPreExecuteå’ŒonPostExecuteä¸æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œä¸æ˜¯å¿…é¡»å®ç°ï¼Œå®ç°è¿™ä¸¤ç§æ–¹æ³•ä¸€èˆ¬èƒ½è®©ä»£ç çš„é€»è¾‘æ›´åŠ æ¸…æ™°ã€‚onPreExecuteè¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œåšä¸€äº›å‡†å¤‡å·¥ä½œã€‚onPostExecuteåŒæ ·è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¸­ï¼Œç”¨äºåœ¨è€—æ—¶æ“ä½œå®Œæˆåï¼Œæ›´æ–°UIã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªonProgressUpdateæ–¹æ³•ï¼Œç”¨äºåœ¨åå°ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­æ¥å®æ—¶åœ°æ›´æ–°UIã€‚</h5><h5 id="doingBackGroundåˆ™æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œå¿…é¡»å®ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨AsyncTaskæ—¶å¸Œæœ›å°†ä¸€äº›è€—æ—¶æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸­ï¼ŒdoingBackGroundä¸­é€»è¾‘å°±ç›¸å½“äºæˆ‘ä»¬åœ¨Thread-Handlerä¸­Threadä¸­çš„runæ–¹æ³•ä¸­å®ç°çš„é€»è¾‘ã€‚"><a href="#doingBackGroundåˆ™æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œå¿…é¡»å®ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨AsyncTaskæ—¶å¸Œæœ›å°†ä¸€äº›è€—æ—¶æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸­ï¼ŒdoingBackGroundä¸­é€»è¾‘å°±ç›¸å½“äºæˆ‘ä»¬åœ¨Thread-Handlerä¸­Threadä¸­çš„runæ–¹æ³•ä¸­å®ç°çš„é€»è¾‘ã€‚" class="headerlink" title="doingBackGroundåˆ™æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œå¿…é¡»å®ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨AsyncTaskæ—¶å¸Œæœ›å°†ä¸€äº›è€—æ—¶æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸­ï¼ŒdoingBackGroundä¸­é€»è¾‘å°±ç›¸å½“äºæˆ‘ä»¬åœ¨Thread-Handlerä¸­Threadä¸­çš„runæ–¹æ³•ä¸­å®ç°çš„é€»è¾‘ã€‚"></a>doingBackGroundåˆ™æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œå¿…é¡»å®ç°ï¼Œæˆ‘ä»¬ä½¿ç”¨AsyncTaskæ—¶å¸Œæœ›å°†ä¸€äº›è€—æ—¶æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸­ï¼ŒdoingBackGroundä¸­é€»è¾‘å°±ç›¸å½“äºæˆ‘ä»¬åœ¨Thread-Handlerä¸­Threadä¸­çš„runæ–¹æ³•ä¸­å®ç°çš„é€»è¾‘ã€‚</h5><h5 id="executeæ–¹æ³•ç”¨äºå¯åŠ¨æ‰§è¡Œä»»åŠ¡"><a href="#executeæ–¹æ³•ç”¨äºå¯åŠ¨æ‰§è¡Œä»»åŠ¡" class="headerlink" title="executeæ–¹æ³•ç”¨äºå¯åŠ¨æ‰§è¡Œä»»åŠ¡"></a>executeæ–¹æ³•ç”¨äºå¯åŠ¨æ‰§è¡Œä»»åŠ¡</h5><ol start="3">
<li>ä»æºç è§’åº¦çœ‹AsyncTaskçš„è®¾è®¡</li>
</ol>
<hr>
<p>æ¥ä¸‹æ¥è¿›å…¥è¿™ç¯‡æ–‡ç« çš„é‡ç‚¹ï¼Œæˆ‘ä»¬ä»æºç è§’åº¦æ¥åˆ†æAsyncTaskæ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<blockquote>
<h4 id="AsyncTaskçš„executeæ–¹æ³•"><a href="#AsyncTaskçš„executeæ–¹æ³•" class="headerlink" title="AsyncTaskçš„executeæ–¹æ³•"></a>AsyncTaskçš„executeæ–¹æ³•</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public final AsyncTask&lt;Params, Progress, Result&gt; execute(Params... params) &#123;</span><br><span class="line">        return executeOnExecutor(sDefaultExecutor, params);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢æ˜¯executeæ–¹æ³•ï¼Œå‘ç°executeå…¶å®å†…éƒ¨è°ƒç”¨çš„executeOnExecutoræ–¹æ³•ï¼Œè°ƒç”¨executeOnExecutoræ–¹æ³•ä¼ é€’äº†ä¸¤ä¸ªå‚æ•°ï¼Œè¿™é‡Œç¬¬ä¸€ä¸ªä¼ é€’äº†ä¸€ä¸ªé»˜è®¤çš„æ‰§è¡Œå™¨ï¼Œå…³äºè¿™ä¸ªsDefaultExecutoræˆ‘ä»¬å†æ¥è®²ï¼Œæˆ‘ä»¬ç°åœ¨æ¥çœ‹AsyncTaskçš„æµç¨‹è®¾è®¡ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹è¿™ä¸ªexecuteOnExecutoræ–¹æ³•,è¿™é‡Œå°†ä¸é‡è¦çš„ä»£ç ç•¥å»äº†ï¼Œå…¶å®è¿™é‡Œé¢çš„é€»è¾‘æ¯”è¾ƒæ¸…æ™°ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">public final AsyncTask&lt;Params, Progress, Result&gt; executeOnExecutor(Executor exec,</span><br><span class="line">           Params... params) &#123;</span><br><span class="line">       .....</span><br><span class="line">       .....</span><br><span class="line"></span><br><span class="line">       mStatus = Status.RUNNING;</span><br><span class="line">       ////////////////////////////////</span><br><span class="line">       // ç¬¬ä¸€æ­¥ï¼šåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œå‡†å¤‡æ“ä½œ////</span><br><span class="line">       onPreExecute();</span><br><span class="line">       // ç¬¬äºŒæ­¥ï¼šæŠŠparamså‚æ•°èµ‹å€¼ç»™mWorker</span><br><span class="line">       mWorker.mParams = params;</span><br><span class="line">       // ç¬¬ä¸‰æ­¥ï¼šç”¨çº¿ç¨‹æ± æ‰§è¡ŒmFuture</span><br><span class="line">       exec.execute(mFuture);</span><br><span class="line">       ///////////////////////</span><br><span class="line">       return this;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>ç¬¬ä¸€æ­¥ï¼ŒonPreExecuteä¸ä¸Šé¢çš„ä»‹ç»ä¸€æ ·ï¼Œè¿›è¡Œå‡†å¤‡å·¥ä½œï¼Œè¿™ä¸ªå°±æ²¡æœ‰å¿…è¦åˆ†æï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰é‡å†™ï¼Œå°±ä¸ä¼šåšç›¸å…³çš„å‡†å¤‡ã€‚æˆ‘ä»¬ä¸»è¦ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥ï¼Œç¬¬äºŒæ­¥ï¼ŒæŠŠparamså‚æ•°èµ‹å€¼ç»™mWorkerï¼Œparamsæ˜¯executeä¸­ä¼ é€’è¿‡æ¥çš„å‚æ•°ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æ³›å‹ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°†paramsèµ‹å€¼ç»™mWorkerï¼Œé‚£ä¹ˆmWorkeræ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<blockquote>
<h4 id="AsyncTaskçš„æ„é€ æ–¹æ³•"><a href="#AsyncTaskçš„æ„é€ æ–¹æ³•" class="headerlink" title="AsyncTaskçš„æ„é€ æ–¹æ³•"></a>AsyncTaskçš„æ„é€ æ–¹æ³•</h4><p>æˆ‘ä»¬ç»§ç»­çœ‹æºç :ä¸»æ„åˆ°mWorkeræ˜¯åœ¨AsyncTaskçš„æ„é€ æ–¹æ³•ä¸­åˆ›å»ºçš„ã€‚</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public AsyncTask() &#123;</span><br><span class="line">        mWorker = new WorkerRunnable&lt;Params, Result&gt;() &#123;</span><br><span class="line">            public Result call() throws Exception &#123;</span><br><span class="line">               .....</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        mFuture = new FutureTask&lt;Result&gt;(mWorker) &#123;</span><br><span class="line">            @Override</span><br><span class="line">            protected void done() &#123;</span><br><span class="line">               .....</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆï¼ŒmWorkeråœ¨æ„é€ æ–¹æ³•ä¸­åˆ›å»ºï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ï¼Œé‚£WorkerRunnableæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private static abstract class WorkerRunnable&lt;Params, Result&gt; implements Callable&lt;Result&gt; &#123;</span><br><span class="line">       Params[] mParams;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å‘ç°WorkerRunnableå…¶å®å°±æ˜¯ä¸€ä¸ªCallableï¼ŒåŒæ—¶åœ¨executeæ–¹æ³•ä¸­mFutureä¹Ÿåœ¨è¿™é‡Œåˆ›å»ºäº†å‡ºæ¥ï¼Œè¿™é‡Œä¼šå°†mWorkerä¼ é€’åˆ°FutureTaskä¸­å»ï¼Œé‚£ä¹ˆå°†mFutureä¼ è¿›å»åšäº†ä»€ä¹ˆä»€ä¹ˆæ“ä½œå‘¢ï¼Ÿ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public FutureTask(Callable&lt;V&gt; callable) &#123;</span><br><span class="line">       if (callable == null)</span><br><span class="line">           throw new NullPointerException();</span><br><span class="line">       //////è¿™é‡Œå°†mWorkerä¼ é€’è¿›æ¥ï¼Œå…¶å®å°±æ˜¯callable///</span><br><span class="line">       /////////////</span><br><span class="line">       this.callable = callable;</span><br><span class="line">       this.state = NEW;       // ensure visibility of callable</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>FutureTaskæ˜¯java.util.concurrentï¼ŒFutureTaskç»§æ‰¿äº†Futureï¼Œé€šè¿‡ Future æ¥å£ï¼Œå¯ä»¥å°è¯•å–æ¶ˆå°šæœªå®Œæˆçš„ä»»åŠ¡ï¼ŒæŸ¥è¯¢ä»»åŠ¡å·²ç»å®Œæˆè¿˜æ˜¯å–æ¶ˆäº†ï¼Œä»¥åŠæå–ï¼ˆæˆ–ç­‰å¾…ï¼‰ä»»åŠ¡çš„ç»“æœå€¼ã€‚</p>
<p>åœ¨AsyncTaskçš„æ„é€ æ–¹æ³•ä¸­ï¼Œå°†mWorkerä¼ è¿›æ¥ï¼Œå³å°†callableä¼ è¿›æ¥ï¼Œå› ä¸ºmWorkerå°±æ˜¯callableã€‚</p>
<p>è¿™æ ·åœ¨ä¸Šé¢çš„executeOnExecutorä¸­çš„ç¬¬ä¸‰æ­¥ä¸­ï¼Œ==exec.execute(mFuture)== ç”¨çº¿ç¨‹æ± æ¥æ‰§è¡ŒmFutureï¼Œå…¶å®å°±æ˜¯æ‰§è¡ŒmFutureä¸­çš„runæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹FutureTaskä¸­çš„runæ–¹æ³•ï¼š</p>
<blockquote>
<h4 id="FutureTaskä¸­çš„runæ–¹æ³•"><a href="#FutureTaskä¸­çš„runæ–¹æ³•" class="headerlink" title="FutureTaskä¸­çš„runæ–¹æ³•"></a>FutureTaskä¸­çš„runæ–¹æ³•</h4></blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">public void run() &#123;</span><br><span class="line">       if (state != NEW ||</span><br><span class="line">           !UNSAFE.compareAndSwapObject(this, runnerOffset,</span><br><span class="line">                                        null, Thread.currentThread()))</span><br><span class="line">           return;</span><br><span class="line">       try &#123;</span><br><span class="line">           Callable&lt;V&gt; c = callable;</span><br><span class="line">           if (c != null &amp;&amp; state == NEW) &#123;</span><br><span class="line">               V result;</span><br><span class="line">               boolean ran;</span><br><span class="line">               try &#123;</span><br><span class="line">                  //â‘  è°ƒç”¨callableä¸­çš„callæ–¹æ³•ï¼Œå…¶å®å°±æ˜¯mWorkerä¸­çš„callæ–¹æ³•</span><br><span class="line">                  //å¹¶ä¸”å°†ç»“æœèµ‹å€¼ç»™result</span><br><span class="line">                   result = c.call();</span><br><span class="line">                   ran = true;</span><br><span class="line">               &#125; catch (Throwable ex) &#123;</span><br><span class="line">                   result = null;</span><br><span class="line">                   ran = false;</span><br><span class="line">                   setException(ex);</span><br><span class="line">               &#125;</span><br><span class="line">               if (ran)</span><br><span class="line">                   //â‘¡ è°ƒç”¨è‡ªå·±å†…éƒ¨çš„setæ–¹æ³•è®¾ç½®ç»“æœ</span><br><span class="line">                   set(result);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; finally &#123;</span><br><span class="line">           // runner must be non-null until state is settled to</span><br><span class="line">           // prevent concurrent calls to run()</span><br><span class="line">           runner = null;</span><br><span class="line">           // state must be re-read after nulling runner to prevent</span><br><span class="line">           // leaked interrupts</span><br><span class="line">           int s = state;</span><br><span class="line">           if (s &gt;= INTERRUPTING)</span><br><span class="line">               handlePossibleCancellationInterrupt(s);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨FutureTaskä¸­çš„runæ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨ä¸¤ä¸ªåœ°æ–¹ï¼Œç¬¬ä¸€ä¸ªï¼Œå°±æ˜¯ä¸Šé¢ä»£ç ç‰‡æ®µçš„â‘ å¤„ï¼Œè¿™é‡Œè°ƒç”¨äº†mWorkerä¸­çš„callæ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å†å›å¤´æ¥çœ‹mWorkerä¸­çš„callæ–¹æ³•ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mWorker = new WorkerRunnable&lt;Params, Result&gt;() &#123;</span><br><span class="line">            public Result call() throws Exception &#123;</span><br><span class="line">                mTaskInvoked.set(true);</span><br><span class="line"></span><br><span class="line">                Process.setThreadPriority(Process.THREAD_PRIORITY_BACKGROUND);</span><br><span class="line">                //noinspection unchecked</span><br><span class="line">                return postResult(doInBackground(mParams));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private Result postResult(Result result) &#123;</span><br><span class="line">       @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">       Message message = sHandler.obtainMessage(MESSAGE_POST_RESULT,</span><br><span class="line">               new AsyncTaskResult&lt;Result&gt;(this, result));</span><br><span class="line">       message.sendToTarget();</span><br><span class="line">       return result;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨mWorkerä¸­callæ–¹æ³•ä¸­ä¸»è¦å°±æ˜¯æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œæ­£æ˜¯doInBackgroundæ–¹æ³•ï¼Œå¹¶ä¸”å°†æ‰§è¡Œçš„ç»“æœresultè¿”å›å›å»ï¼Œç”¨postResultå¯¹doInBackgroundè¿›è¡ŒåŒ…è£¹åˆ™æ˜¯ä¸ºäº†è¿ç”¨Handleræœºåˆ¶æ¥æ›´æ–°UIã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹FutureTaskä¸­runæ–¹æ³•ä¸­çš„â‘¡å¤„ï¼Œè°ƒç”¨äº†FutureTaskè‡ªå·±çš„setæ–¹æ³•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">protected void set(V v) &#123;</span><br><span class="line">        if (UNSAFE.compareAndSwapInt(this, stateOffset, NEW, COMPLETING)) &#123;</span><br><span class="line">            outcome = v;</span><br><span class="line">            UNSAFE.putOrderedInt(this, stateOffset, NORMAL); // final state</span><br><span class="line">            finishCompletion();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">private void finishCompletion() &#123;</span><br><span class="line">       // assert state &gt; COMPLETING;</span><br><span class="line">       for (WaitNode q; (q = waiters) != null;) &#123;</span><br><span class="line">           if (UNSAFE.compareAndSwapObject(this, waitersOffset, q, null)) &#123;</span><br><span class="line">               for (;;) &#123;</span><br><span class="line">                   Thread t = q.thread;</span><br><span class="line">                   if (t != null) &#123;</span><br><span class="line">                       q.thread = null;</span><br><span class="line">                       LockSupport.unpark(t);</span><br><span class="line">                   &#125;</span><br><span class="line">                   WaitNode next = q.next;</span><br><span class="line">                   if (next == null)</span><br><span class="line">                       break;</span><br><span class="line">                   q.next = null; // unlink to help gc</span><br><span class="line">                   q = next;</span><br><span class="line">               &#125;</span><br><span class="line">               break;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       //â‘  è°ƒç”¨äº†FutureTaskä¸­çš„doneæ–¹æ³•</span><br><span class="line">       done();</span><br><span class="line"></span><br><span class="line">       callable = null;        // to reduce footprint</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>ç”±setæ–¹æ³•ï¼Œè°ƒç”¨finishCompletionï¼Œä¸»è¦çœ‹finishCompletionçš„é€»è¾‘ï¼Œæˆ‘ä»¬åªå…³æ³¨finishCompletionä»£ç çš„â‘ å¤„ï¼Œè¿™é‡Œè°ƒç”¨äº†doneæ–¹æ³•ï¼Œ<br>è¿™æ ·æˆ‘ä»¬æ¥çœ‹doneæ–¹æ³•ä¸­çš„é€»è¾‘ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mFuture = new FutureTask&lt;Result&gt;(mWorker) &#123;</span><br><span class="line">            @Override</span><br><span class="line">            protected void done() &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    postResultIfNotInvoked(get());</span><br><span class="line">                &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                    android.util.Log.w(LOG_TAG, e);</span><br><span class="line">                &#125; catch (ExecutionException e) &#123;</span><br><span class="line">                    throw new RuntimeException(&quot;An error occured while executing doInBackground()&quot;,</span><br><span class="line">                            e.getCause());</span><br><span class="line">                &#125; catch (CancellationException e) &#123;</span><br><span class="line">                    postResultIfNotInvoked(null);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br></pre></td></tr></table></figure>
<p>åœ¨Futureä¸­è°ƒç”¨äº†postResultIfNotInvokedï¼Œå…¶å®è¿™é‡Œå°†è¿™æ®µå¤„ç†é€»è¾‘æŠ½å–åˆ°æ–¹æ³•ä¸­å»äº†ï¼Œåœ¨android2.3å³ä»¥å‰çš„æºç éƒ½æ˜¯æ²¡æœ‰æŠ½å–çš„ï¼Œè¿™ä¹Ÿæ˜¯ä½¿å¾—ç°åœ¨çš„é€»è¾‘æ›´åŠ æ¸…æ™°ã€‚<br>==java.util.concurrent.atomic.AtomicBoolean ï¼ˆ åœ¨è¿™ä¸ªBooleanå€¼çš„å˜åŒ–çš„æ—¶å€™ä¸å…è®¸åœ¨ä¹‹é—´æ’å…¥ï¼Œä¿æŒæ“ä½œçš„åŸå­æ€§==ï¼‰<br>ç”±äºåœ¨mWorkerä¸­çš„callå’Œåœ¨mFutureçš„doneæ–¹æ³•éƒ½ä¼šè°ƒç”¨postResultæ¥æ›´æ–°UIï¼Œç”±äºæ˜¯çº¿ç¨‹æ“ä½œï¼Œä¸èƒ½ä¿è¯å…ˆåé¡ºåºï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨AtomicBooleanæ¥ä¿æŒæ“ä½œçš„åŸå­æ€§ã€‚å…¶å®åœ¨2.3ä¸Šçš„ä»£ç ä¸æ˜¯è¿™æ ·å¤„ç†çš„ï¼Œ2.3ä¸Šå°†æ›´æ–°UIçš„æ“ä½œéƒ½æ”¾åœ¨mFutureä¸­çš„doneæ–¹æ³•ä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">private void postResultIfNotInvoked(Result result) &#123;</span><br><span class="line">        final boolean wasTaskInvoked = mTaskInvoked.get();</span><br><span class="line">        if (!wasTaskInvoked) &#123;</span><br><span class="line">            postResult(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹postResultæ–¹æ³•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">private Result postResult(Result result) &#123;</span><br><span class="line">      @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">      Message message = sHandler.obtainMessage(MESSAGE_POST_RESULT,</span><br><span class="line">              new AsyncTaskResult&lt;Result&gt;(this, result));</span><br><span class="line">      message.sendToTarget();</span><br><span class="line">      return result;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œå°±æ˜¯æˆ‘ä»¬éå¸¸ç†Ÿæ‚‰çš„ä»£ç äº†ï¼Œä½¿ç”¨Messageå‘é€æ¶ˆæ¯ç»™Handleræ¥æ›´æ–°UIã€‚<br>åœ¨AsyncTaskä¸­å®šä¹‰äº†ä¸€ä¸ªInternalHandlerï¼Œå¦‚æœè€—æ—¶æ“ä½œæ‰§è¡Œå®Œæ¯•ï¼Œå°±ä¼šæ‰§è¡Œfinish(result.mData[0])ï¼Œå¦‚æœç»“æœæ­£åœ¨æ‰§è¡Œï¼Œåˆ™ä¼šonProgressUpdateæ¥æ›´æ–°è¿›åº¦ï¼Œè¿™ä¸ªonProgressUpdateæ­£æ˜¯æˆ‘ä»¬å‰é¢è¯´åˆ°çš„éœ€è¦å®ç°çš„æ›´æ–°è¿›åº¦çš„æ–¹æ³•ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">private static class InternalHandler extends Handler &#123;</span><br><span class="line">        @SuppressWarnings(&#123;&quot;unchecked&quot;, &quot;RawUseOfParameterizedType&quot;&#125;)</span><br><span class="line">        @Override</span><br><span class="line">        public void handleMessage(Message msg) &#123;</span><br><span class="line">            AsyncTaskResult result = (AsyncTaskResult) msg.obj;</span><br><span class="line">            switch (msg.what) &#123;</span><br><span class="line">                case MESSAGE_POST_RESULT:</span><br><span class="line">                    // There is only one result</span><br><span class="line">                    result.mTask.finish(result.mData[0]);</span><br><span class="line">                    break;</span><br><span class="line">                case MESSAGE_POST_PROGRESS:</span><br><span class="line">                    result.mTask.onProgressUpdate(result.mData);</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>AsyncTaskResultç±»çš„åªæ˜¯ä¸€ä¸ªå°è£…<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@SuppressWarnings(&#123;&quot;RawUseOfParameterizedType&quot;&#125;)</span><br><span class="line">  private static class AsyncTaskResult&lt;Data&gt; &#123;</span><br><span class="line">      final AsyncTask mTask;</span><br><span class="line">      final Data[] mData;</span><br><span class="line"></span><br><span class="line">      AsyncTaskResult(AsyncTask task, Data... data) &#123;</span><br><span class="line">          mTask = task;</span><br><span class="line">          mData = data;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">private void finish(Result result) &#123;</span><br><span class="line">        if (isCancelled()) &#123;</span><br><span class="line">            onCancelled(result);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            //////è€—æ—¶æ“ä½œæ‰§è¡Œå®Œæ¯•ï¼Œæ›´æ–°UI///////////</span><br><span class="line">            //onPostExecuteè¿è¡Œåœ¨ä¸»çº¿ç¨‹</span><br><span class="line">            onPostExecute(result);</span><br><span class="line">            //////////////////////////////////////////</span><br><span class="line">        &#125;</span><br><span class="line">        mStatus = Status.FINISHED;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>##############################################################</p>
<p>è¿™æ ·æˆ‘ä»¬å…³äºAsyncTaskçš„æµç¨‹ç»ˆäºèµ°é€šäº†ï¼Œä¸ºä»€ä¹ˆonPreExecuteå’ŒonPostExecuteè¿è¡Œåœ¨ä¸»çº¿ç¨‹ï¼Œè€ŒdoingBackGroundä¸ºä»€ä¹ˆè¿è¡Œåœ¨å­çº¿ç¨‹ä¸­ï¼Œè¿™ä¸ªé€»è¾‘æ˜¯ä¸æ˜¯å°±å˜å¾—æ¸…æ™°äº†ã€‚ä¸Šé¢è´´äº†å¥½å¤šä»£ç ï¼Œä¸€ç›´éƒ½æ˜¯åœ¨åˆ†æä»£ç çš„æ„æ€ï¼Œè‡³äºå…³äºè®¾è®¡çš„æ€æƒ³æ„Ÿè§‰ç°åœ¨çš„è‡ªå·±è¿˜ä½“æ‚Ÿä¸å¤Ÿã€‚</p>
<ol start="4">
<li>AsyncTaskåœ¨ä¸Šé¢é—ç•™çš„é—®é¢˜</li>
</ol>
<hr>
<p>å…³äºAsyncTaskä¸­executeOnExecutorä¸­çš„sDefaultExecutor</p>
<p>é¡¹ç›®ä¸­é—®é¢˜åœºæ™¯ï¼š</p>
<p>æ“ä½œæ­¥éª¤&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</p>
<ul>
<li>è®¾ç½®å®‰å…¨ä¸­ï¼Œé€‰æ‹©æŒ‡çº¹ã€‚</li>
<li>è§£é”æ–¹å¼é€‰æ‹©å›¾æ¡ˆã€‚</li>
<li>åœ¨é€‰æ‹©æ‚¨çš„å›¾æ¡ˆç•Œé¢ï¼Œç‚¹å‡»ç¡®å®šï¼Œéœ€è¦ä¸‰åˆ°äº”ç§’æ‰èƒ½è·³è½¬åˆ°ä¸‹ä¸€ç•Œé¢ã€‚</li>
</ul>
<p>é—®é¢˜åˆ†æï¼šåœ¨è®¾ç½®è§£é”æ–¹å¼ä¸ºä¸ºå›¾æ¡ˆæ—¶ï¼Œç¬¬äºŒæ¬¡ç»˜åˆ¶å›¾æ¡ˆåï¼ŒSettingsæºç ä¸­ä½¿ç”¨äº†AsyncTaskæ¥å°†ä¸€äº›æ¯”è¾ƒè€—æ—¶çš„éªŒè¯æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸­å»å¤„ç†(å‚çœ‹ä¸‹é¢çš„éƒ¨åˆ†ä»£ç )ï¼Œç”±äºandroidåŸç”Ÿè®¾è®¡æ˜¯ä½¿ç”¨<br>AsyncTaskä¸­çš„ä¸€ä¸ªå‚æ•°çš„æ–¹æ³•ï¼Œä¸€ä¸ªå‚æ•°çš„æ–¹æ³•é‡‡ç”¨çš„æ˜¯é»˜è®¤çš„æ‰§è¡Œå™¨ï¼Œå³ä¸²è¡Œæ‰§è¡Œå™¨</p>
<p>==frameworks/base/core/java/com/android/internal/widget/LockPatternChecker.java==</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public static AsyncTask&lt;?, ?, ?&gt; verifyPattern(final LockPatternUtils utils,</span><br><span class="line">            final List&lt;LockPatternView.Cell&gt; pattern,</span><br><span class="line">            final long challenge,</span><br><span class="line">            final int userId,</span><br><span class="line">            final OnVerifyCallback callback) &#123;</span><br><span class="line">        AsyncTask&lt;Void, Void, byte[]&gt; task = new AsyncTask&lt;Void, Void, byte[]&gt;() &#123;</span><br><span class="line">            private int mThrottleTimeout;</span><br><span class="line">            @Override</span><br><span class="line">            protected byte[] doInBackground(Void... args) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    return utils.verifyPattern(pattern, challenge, userId);</span><br><span class="line">                &#125; catch (RequestThrottledException ex) &#123;</span><br><span class="line">                    mThrottleTimeout = ex.getTimeoutMs();</span><br><span class="line">                    return null;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            @Override</span><br><span class="line">            protected void onPostExecute(byte[] result) &#123;</span><br><span class="line">                callback.onVerified(result, mThrottleTimeout);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        ////////////é»˜è®¤ä½¿ç”¨çš„ä¸²è¡Œçš„æ‰§è¡Œå™¨//////////////</span><br><span class="line">        task.execute();</span><br><span class="line">        ///////////////////////////////////////////////</span><br><span class="line">        return task;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">public static final Executor SERIAL_EXECUTOR = new SerialExecutor();</span><br><span class="line">private static volatile Executor sDefaultExecutor = SERIAL_EXECUTOR;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">private static class SerialExecutor implements Executor &#123;</span><br><span class="line">        final ArrayDeque&lt;Runnable&gt; mTasks = new ArrayDeque&lt;Runnable&gt;();</span><br><span class="line">        Runnable mActive;</span><br><span class="line"></span><br><span class="line">        public synchronized void execute(final Runnable r) &#123;</span><br><span class="line">            mTasks.offer(new Runnable() &#123;</span><br><span class="line">                public void run() &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        r.run();</span><br><span class="line">                    &#125; finally &#123;</span><br><span class="line">                        scheduleNext();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            if (mActive == null) &#123;</span><br><span class="line">                scheduleNext();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        protected synchronized void scheduleNext() &#123;</span><br><span class="line">            if ((mActive = mTasks.poll()) != null) &#123;</span><br><span class="line">                THREAD_POOL_EXECUTOR.execute(mActive);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h5 id="æˆ‘ä»¬å‘ç°SerialExecutorå³æ˜¯ä¸²è¡Œæ‰§è¡Œå™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¿è¯ä»»åŠ¡æ‰§è¡Œçš„é¡ºåºï¼Œä¹Ÿå°±æ˜¯å®ƒå¯ä»¥ä¿è¯æäº¤çš„ä»»åŠ¡ç¡®å®æ˜¯æŒ‰ç…§å…ˆåé¡ºåºæ‰§è¡Œçš„ã€‚å®ƒçš„å†…éƒ¨æœ‰ä¸€ä¸ªé˜Ÿåˆ—ç”¨æ¥ä¿å­˜æ‰€æäº¤çš„ä»»åŠ¡ï¼Œä¿è¯å½“å‰åªè¿è¡Œä¸€ä¸ªï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ä»»åŠ¡æ˜¯å®Œå…¨æŒ‰ç…§é¡ºåºæ‰§è¡Œçš„ã€‚å¦‚æœå‘ç°å¼‚æ­¥ä»»åŠ¡è¿˜æœªæ‰§è¡Œï¼Œå¯èƒ½è¢«æˆ‘ä»¬å‘ç°SerialExecutorå³æ˜¯ä¸²è¡Œæ‰§è¡Œå™¨é¡ºåºçš„ä½¿ç”¨çº¿ç¨‹æ‰§è¡Œã€‚å› ä¸ºåº”ç”¨ä¸­å¯èƒ½è¿˜æœ‰å…¶ä»–åœ°æ–¹ä½¿ç”¨AsyncTaskï¼Œæ‰€ä»¥åˆ°æˆ‘ä»¬çš„AsyncTaskä¹Ÿè®¸ä¼šç­‰å¾…åˆ°å…¶ä»–ä»»åŠ¡éƒ½å®Œæˆæ—¶æ‰å¾—ä»¥æ‰§è¡Œè€Œä¸æ˜¯è°ƒç”¨executor-ä¹‹åé©¬ä¸Šæ‰§è¡Œã€‚"><a href="#æˆ‘ä»¬å‘ç°SerialExecutorå³æ˜¯ä¸²è¡Œæ‰§è¡Œå™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¿è¯ä»»åŠ¡æ‰§è¡Œçš„é¡ºåºï¼Œä¹Ÿå°±æ˜¯å®ƒå¯ä»¥ä¿è¯æäº¤çš„ä»»åŠ¡ç¡®å®æ˜¯æŒ‰ç…§å…ˆåé¡ºåºæ‰§è¡Œçš„ã€‚å®ƒçš„å†…éƒ¨æœ‰ä¸€ä¸ªé˜Ÿåˆ—ç”¨æ¥ä¿å­˜æ‰€æäº¤çš„ä»»åŠ¡ï¼Œä¿è¯å½“å‰åªè¿è¡Œä¸€ä¸ªï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ä»»åŠ¡æ˜¯å®Œå…¨æŒ‰ç…§é¡ºåºæ‰§è¡Œçš„ã€‚å¦‚æœå‘ç°å¼‚æ­¥ä»»åŠ¡è¿˜æœªæ‰§è¡Œï¼Œå¯èƒ½è¢«æˆ‘ä»¬å‘ç°SerialExecutorå³æ˜¯ä¸²è¡Œæ‰§è¡Œå™¨é¡ºåºçš„ä½¿ç”¨çº¿ç¨‹æ‰§è¡Œã€‚å› ä¸ºåº”ç”¨ä¸­å¯èƒ½è¿˜æœ‰å…¶ä»–åœ°æ–¹ä½¿ç”¨AsyncTaskï¼Œæ‰€ä»¥åˆ°æˆ‘ä»¬çš„AsyncTaskä¹Ÿè®¸ä¼šç­‰å¾…åˆ°å…¶ä»–ä»»åŠ¡éƒ½å®Œæˆæ—¶æ‰å¾—ä»¥æ‰§è¡Œè€Œä¸æ˜¯è°ƒç”¨executor-ä¹‹åé©¬ä¸Šæ‰§è¡Œã€‚" class="headerlink" title="æˆ‘ä»¬å‘ç°SerialExecutorå³æ˜¯ä¸²è¡Œæ‰§è¡Œå™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¿è¯ä»»åŠ¡æ‰§è¡Œçš„é¡ºåºï¼Œä¹Ÿå°±æ˜¯å®ƒå¯ä»¥ä¿è¯æäº¤çš„ä»»åŠ¡ç¡®å®æ˜¯æŒ‰ç…§å…ˆåé¡ºåºæ‰§è¡Œçš„ã€‚å®ƒçš„å†…éƒ¨æœ‰ä¸€ä¸ªé˜Ÿåˆ—ç”¨æ¥ä¿å­˜æ‰€æäº¤çš„ä»»åŠ¡ï¼Œä¿è¯å½“å‰åªè¿è¡Œä¸€ä¸ªï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ä»»åŠ¡æ˜¯å®Œå…¨æŒ‰ç…§é¡ºåºæ‰§è¡Œçš„ã€‚å¦‚æœå‘ç°å¼‚æ­¥ä»»åŠ¡è¿˜æœªæ‰§è¡Œï¼Œå¯èƒ½è¢«æˆ‘ä»¬å‘ç°SerialExecutorå³æ˜¯ä¸²è¡Œæ‰§è¡Œå™¨é¡ºåºçš„ä½¿ç”¨çº¿ç¨‹æ‰§è¡Œã€‚å› ä¸ºåº”ç”¨ä¸­å¯èƒ½è¿˜æœ‰å…¶ä»–åœ°æ–¹ä½¿ç”¨AsyncTaskï¼Œæ‰€ä»¥åˆ°æˆ‘ä»¬çš„AsyncTaskä¹Ÿè®¸ä¼šç­‰å¾…åˆ°å…¶ä»–ä»»åŠ¡éƒ½å®Œæˆæ—¶æ‰å¾—ä»¥æ‰§è¡Œè€Œä¸æ˜¯è°ƒç”¨executor()ä¹‹åé©¬ä¸Šæ‰§è¡Œã€‚"></a>æˆ‘ä»¬å‘ç°SerialExecutorå³æ˜¯ä¸²è¡Œæ‰§è¡Œå™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¿è¯ä»»åŠ¡æ‰§è¡Œçš„é¡ºåºï¼Œä¹Ÿå°±æ˜¯å®ƒå¯ä»¥ä¿è¯æäº¤çš„ä»»åŠ¡ç¡®å®æ˜¯æŒ‰ç…§å…ˆåé¡ºåºæ‰§è¡Œçš„ã€‚å®ƒçš„å†…éƒ¨æœ‰ä¸€ä¸ªé˜Ÿåˆ—ç”¨æ¥ä¿å­˜æ‰€æäº¤çš„ä»»åŠ¡ï¼Œä¿è¯å½“å‰åªè¿è¡Œä¸€ä¸ªï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ä»»åŠ¡æ˜¯å®Œå…¨æŒ‰ç…§é¡ºåºæ‰§è¡Œçš„ã€‚å¦‚æœå‘ç°å¼‚æ­¥ä»»åŠ¡è¿˜æœªæ‰§è¡Œï¼Œå¯èƒ½è¢«æˆ‘ä»¬å‘ç°SerialExecutorå³æ˜¯ä¸²è¡Œæ‰§è¡Œå™¨é¡ºåºçš„ä½¿ç”¨çº¿ç¨‹æ‰§è¡Œã€‚å› ä¸ºåº”ç”¨ä¸­å¯èƒ½è¿˜æœ‰å…¶ä»–åœ°æ–¹ä½¿ç”¨AsyncTaskï¼Œæ‰€ä»¥åˆ°æˆ‘ä»¬çš„AsyncTaskä¹Ÿè®¸ä¼šç­‰å¾…åˆ°å…¶ä»–ä»»åŠ¡éƒ½å®Œæˆæ—¶æ‰å¾—ä»¥æ‰§è¡Œè€Œä¸æ˜¯è°ƒç”¨executor()ä¹‹åé©¬ä¸Šæ‰§è¡Œã€‚</h5></blockquote>
<p>å¦‚æœexecuteOnExecutor(AsyncTask.THREAD_POOL_EXECUTOR,params)åˆ™ä¸ä¸€æ ·ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * An &#123;@link Executor&#125; that can be used to execute tasks in parallel.</span><br><span class="line">    */</span><br><span class="line">   public static final Executor THREAD_POOL_EXECUTOR</span><br><span class="line">           = new ThreadPoolExecutor(CORE_POOL_SIZE, MAXIMUM_POOL_SIZE, KEEP_ALIVE,</span><br><span class="line">                   TimeUnit.SECONDS, sPoolWorkQueue, sThreadFactory);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<h5 id="APIä¸­çš„è§£é‡Šï¼šèƒ½å¤Ÿå¹¶è¡Œçš„æ‰§è¡Œä»»åŠ¡ã€‚THREAD-POOL-EXECUTORæ˜¯ä¸€ä¸ªæ•°é‡ä¸ºcorePoolSizeçš„çº¿ç¨‹æ± ï¼Œå…·ä½“çº¿ç¨‹æ± çš„æ•°é‡æ˜¯ä¾æ®CPUçš„æ ¸å¿ƒæ¥è®¾ç½®çš„ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°é‡çš„çº¿ç¨‹ä¸ªæ•°å°±éœ€è¦ç­‰å¾…"><a href="#APIä¸­çš„è§£é‡Šï¼šèƒ½å¤Ÿå¹¶è¡Œçš„æ‰§è¡Œä»»åŠ¡ã€‚THREAD-POOL-EXECUTORæ˜¯ä¸€ä¸ªæ•°é‡ä¸ºcorePoolSizeçš„çº¿ç¨‹æ± ï¼Œå…·ä½“çº¿ç¨‹æ± çš„æ•°é‡æ˜¯ä¾æ®CPUçš„æ ¸å¿ƒæ¥è®¾ç½®çš„ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°é‡çš„çº¿ç¨‹ä¸ªæ•°å°±éœ€è¦ç­‰å¾…" class="headerlink" title="APIä¸­çš„è§£é‡Šï¼šèƒ½å¤Ÿå¹¶è¡Œçš„æ‰§è¡Œä»»åŠ¡ã€‚THREAD_POOL_EXECUTORæ˜¯ä¸€ä¸ªæ•°é‡ä¸ºcorePoolSizeçš„çº¿ç¨‹æ± ï¼Œå…·ä½“çº¿ç¨‹æ± çš„æ•°é‡æ˜¯ä¾æ®CPUçš„æ ¸å¿ƒæ¥è®¾ç½®çš„ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°é‡çš„çº¿ç¨‹ä¸ªæ•°å°±éœ€è¦ç­‰å¾…"></a>APIä¸­çš„è§£é‡Šï¼šèƒ½å¤Ÿå¹¶è¡Œçš„æ‰§è¡Œä»»åŠ¡ã€‚THREAD_POOL_EXECUTORæ˜¯ä¸€ä¸ªæ•°é‡ä¸ºcorePoolSizeçš„çº¿ç¨‹æ± ï¼Œå…·ä½“çº¿ç¨‹æ± çš„æ•°é‡æ˜¯ä¾æ®CPUçš„æ ¸å¿ƒæ¥è®¾ç½®çš„ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°é‡çš„çº¿ç¨‹ä¸ªæ•°å°±éœ€è¦ç­‰å¾…</h5></blockquote>
<p>SerialExecutoræ˜¯æŒ‰é¡ºåºæ‰§è¡Œï¼ŒTHREAD_POOL_EXECUTORåˆ™ä¸€å®šç¨‹åº¦ä¸Šèƒ½ä¿è¯å¹¶è¡Œæ‰§è¡Œã€‚</p>
<p>ä»¥ä¸Šå°±æ˜¯å…³äºAsyncTaskçš„å…¨éƒ¨å†…å®¹ï¼Œå¸Œæœ›èƒ½å¯¹ä½ æœ‰äº›å¸®åŠ©ï¼Œè´´äº†å¥½å¤šæºç ï¼Œå¦‚æœæƒ³çœŸæ­£å¼„æ¸…æ¥šï¼Œè¿˜æ˜¯å¾—è‡ªå·±å»é˜…è¯»é˜…è¯»æºç ï¼Œæ•´ç†è¿™ä¸ªä¹Ÿä¸å®¹æ˜“ï¼Œå‰å‰ååèŠ±äº†å¤§æ¦‚ä¸€ä¸ªæ˜ŸæœŸã€‚<br>æœ€åæ˜¯AsyncTaskçš„æ—¶åºå›¾ï¼Œç”»çš„ä¸å¤ªå¥½ï¼Œå‡‘åˆçœ‹å§ï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆ~<br><img src="https://raw.githubusercontent.com/JasonGaoH/Images/master/AsyncTask.png" alt="AsyncTaskæ—¶åºå›¾"></p>
</section>
    <!-- Tags START -->
    
      <div class="tags">
        <span>Tags:</span>
        
  <a href="/tags#Android">
    <span class="tag-code">Android</span>
  </a>

  <a href="/tags#AsyncTask">
    <span class="tag-code">AsyncTask</span>
  </a>

      </div>
    
    <!-- Tags END -->
    <!-- NAV START -->
    
  <div class="nav-container">
    <!-- reverse left and right to put prev and next in a more logic postition -->
    
      <a class="nav-left" href="/2019/03/22/å…³äºTabLayoutçš„indicatorå®½åº¦çš„ä¸€æ¬¡æ¢ç´¢/">
        <span class="nav-arrow">â† </span>
        
          å…³äºTabLayoutçš„indicatorå®½åº¦çš„ä¸€æ¬¡æ¢ç´¢
        
      </a>
    
    
      <a class="nav-right" href="/2020/05/21/androidå¯åŠ¨æµç¨‹åˆ†æ/">
        
          androidå¯åŠ¨æµç¨‹åˆ†æ
        
        <span class="nav-arrow"> â†’</span>
      </a>
    
  </div>

    <!-- NAV END -->
    <!-- æ‰“èµ START -->
    
    <!-- æ‰“èµ END -->
    <!-- äºŒç»´ç  START -->
    
      <div class="qrcode"></div>
      <p class="notice">å…¬ä¼—å·åŒæ­¥æ›´æ–°ï¼Œæ¬¢è¿å…³æ³¨ğŸ˜„</p>
    
    <!-- äºŒç»´ç  END -->
    
      <!-- Disqus START -->
      <div id="disqus_thread"></div>
      <!-- Disqus END -->
    
  </article>
  <!-- Article END -->
  <!-- Catalog START -->
  
  <!-- Catalog END -->

</main>

<script>
  (function () {
    var url = 'JasonGaoH.github.io/2019/03/23/æ·±å…¥åˆ†æAsyncTask/';
    var banner = ''
    if (banner !== '' && banner !== 'undefined' && banner !== 'null') {
      $('#article-banner').css({
        'background-image': 'url(' + banner + ')'
      })
    } else {
      $('#article-banner').geopattern(url)
    }
    $('.header').removeClass('fixed-header')

    // error image
    $(".markdown-content img").on('error', function() {
      $(this).attr('src', '/css/images/error_icon.png')
      $(this).css({
        'cursor': 'default'
      })
    })

    // zoom image
    $(".markdown-content img").on('click', function() {
      var src = $(this).attr('src')
      if (src !== '/css/images/error_icon.png') {
        var imageW = $(this).width()
        var imageH = $(this).height()

        var zoom = ($(window).width() * 0.95 / imageW).toFixed(2)
        zoom = zoom < 1 ? 1 : zoom
        zoom = zoom > 2 ? 2 : zoom
        var transY = (($(window).height() - imageH) / 2).toFixed(2)

        $('body').append('<div class="image-view-wrap"><div class="image-view-inner"><img src="'+ src +'" /></div></div>')
        $('.image-view-wrap').addClass('wrap-active')
        $('.image-view-wrap img').css({
          'width': `${imageW}`,
          'transform': `translate3d(0, ${transY}px, 0) scale3d(${zoom}, ${zoom}, 1)`
        })
        $('html').css('overflow', 'hidden')

        $('.image-view-wrap').on('click', function() {
          $(this).remove()
          $('html').attr('style', '')
        })
      }
    })
  })();
</script>






  <script>
    var disqus_shortname = 'jasongaoh';
    
    var disqus_url = 'JasonGaoH.github.io/2019/03/23/æ·±å…¥åˆ†æAsyncTask/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//go.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>


    <div class="scroll-top">
  <span class="arrow-icon"></span>
</div>
    <footer class="app-footer">
  <p class="copyright">
    &copy; 2023 | Proudly powered by <a href="https://hexo.io" target="_blank">Hexo</a>
    
    

    <br>
    æœ¬ç«™ç´¯è®¡è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>,
    æœ¬ç«™ç´¯è®¡è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>
  </p>
</footer>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script>
  function async(u, c) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
</script>
<script>
  async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
    FastClick.attach(document.body);
  })
</script>

<script>
  var hasLine = 'true';
  async("//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js", function(){
    $('figure pre').each(function(i, block) {
      var figure = $(this).parents('figure');
      if (hasLine === 'false') {
        figure.find('.gutter').hide();
      }
      hljs.configure({useBR: true});
      var lang = figure.attr('class').split(' ')[1] || 'code';
      var codeHtml = $(this).html();
      var codeTag = document.createElement('code');
      codeTag.className = lang;
      codeTag.innerHTML = codeHtml;
      $(this).attr('class', '').empty().html(codeTag);
      figure.attr('data-lang', lang.toUpperCase());
      hljs.highlightBlock(block);
    });
  })
</script>
<!-- Baidu Tongji -->

<script src="/js/script.js"></script>

  </body>
</html>